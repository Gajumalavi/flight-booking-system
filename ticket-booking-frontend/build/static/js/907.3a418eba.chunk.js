"use strict";(self.webpackChunkticket_booking_frontend=self.webpackChunkticket_booking_frontend||[]).push([[907],{13907:(e,t,o)=>{o.r(t),o.d(t,{default:()=>_t});var s=o(82483),r=o(99891),n=o(93376),i=o(76229),a=o(85794),l=o(16253),c=o(65470),d=o(41856),h=o(99440),m=o(15269),x=o(97234),g=o(89086),u=o(74312),p=o(30087),A=o(61726),f=o(85201),b=o(39846),j=o(30614),y=o(72234),v=o(56723);const S=()=>{var e;const t=(0,n.Zp)(),o=(0,n.zy)(),{isAuthenticated:r,user:S,logout:k,checkAuth:C}=(0,y.As)(),[I,w]=(0,s.useState)({isAuthenticated:!1,isAdmin:!1,checked:!1});(0,s.useEffect)((()=>{(()=>{const e=C(),t="ADMIN"===(null===S||void 0===S?void 0:S.role);console.log("Navbar auth check:",{isAuth:e,user:S,isAdmin:t}),w({isAuthenticated:e,isAdmin:t,checked:!0})})()}),[C,S,o.pathname]);const[N,F]=(0,s.useState)(null),E=Boolean(N),B=()=>{F(null)};return(0,v.jsx)(i.A,{position:"static",sx:{background:"linear-gradient(45deg, #E33069 30%, #9C27B0 90%)",boxShadow:"0px 4px 8px rgba(0, 0, 0, 0.1)"},children:(0,v.jsxs)(a.A,{children:[(0,v.jsx)(l.A,{size:"large",edge:"start",color:"inherit","aria-label":"menu",sx:{mr:2},onClick:()=>t("/"),children:(0,v.jsx)(p.A,{})}),(0,v.jsx)(c.A,{variant:"h6",component:"div",sx:{flexGrow:1},children:"Flight Booking System"}),(0,v.jsx)(d.A,{color:"inherit",onClick:()=>t("/flights"),startIcon:(0,v.jsx)(A.A,{}),children:"Flights"}),I.isAuthenticated&&(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)(d.A,{color:"inherit",onClick:()=>t("/profile"),startIcon:(0,v.jsx)(f.A,{}),children:"Profile"}),(0,v.jsx)(d.A,{color:"inherit",onClick:()=>t("/bookings"),startIcon:(0,v.jsx)(b.A,{}),children:"Bookings"}),I.isAdmin&&(0,v.jsx)(d.A,{color:"inherit",onClick:()=>{console.log("Admin button clicked, navigating to /admin"),t("/admin")},startIcon:(0,v.jsx)(j.A,{}),children:"Admin"})]}),I.isAuthenticated?(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)(h.A,{title:(null===S||void 0===S?void 0:S.email)||"User",children:(0,v.jsx)(l.A,{onClick:e=>{F(e.currentTarget)},size:"small","aria-controls":E?"account-menu":void 0,"aria-haspopup":"true","aria-expanded":E?"true":void 0,sx:{ml:2},children:(0,v.jsx)(m.A,{sx:{width:32,height:32,bgcolor:"#FF7F23"},children:(null===S||void 0===S||null===(e=S.email)||void 0===e?void 0:e.charAt(0).toUpperCase())||"U"})})}),(0,v.jsxs)(x.A,{id:"basic-menu",anchorEl:N,open:E,onClose:B,MenuListProps:{"aria-labelledby":"basic-button"},PaperProps:{sx:{borderRadius:"8px",boxShadow:"0px 4px 8px rgba(0, 0, 0, 0.1)"}},children:[(0,v.jsx)(g.A,{onClick:()=>{B(),t("/profile")},children:"Profile"}),(0,v.jsx)(g.A,{onClick:()=>{B(),t("/bookings")},children:"My Bookings"}),I.isAdmin&&(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)(u.A,{}),(0,v.jsx)(g.A,{onClick:()=>{B(),console.log("Admin menu item clicked, navigating to /admin"),t("/admin")},children:"Admin Dashboard"})]}),(0,v.jsx)(u.A,{}),(0,v.jsx)(g.A,{onClick:()=>{k(),B(),t("/")},children:"Logout"})]})]}):(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)(d.A,{color:"inherit",onClick:()=>t("/login"),sx:{borderRadius:"8px"},children:"Login"}),(0,v.jsx)(d.A,{color:"inherit",onClick:()=>t("/register"),sx:{ml:1,bgcolor:"rgba(255, 255, 255, 0.15)",borderRadius:"8px","&:hover":{bgcolor:"rgba(255, 255, 255, 0.25)"}},children:"Register"})]})]})})};var k=o(43063),C=o(77924),I=o(52891),w=o(60146),N=o(98717),F=o(20792),E=o(22555),B=o(3888),D=o(81871),R=o(91186);const P=e=>{let{error:t,severity:o="error",title:s,onClose:r,action:n,sx:i={}}=e;return t?(0,v.jsx)(I.A,{sx:(0,E.A)({width:"100%",mb:2},i),children:(0,v.jsx)(B.A,{in:!!t,children:(0,v.jsxs)(w.A,{severity:o,action:r?(0,v.jsx)(l.A,{"aria-label":"close",color:"inherit",size:"small",onClick:r,children:(0,v.jsx)(R.A,{fontSize:"inherit"})}):n,children:[s&&(0,v.jsx)(D.A,{children:s}),t]})})}):null},M=()=>{const e=(0,n.Zp)(),t=(0,n.zy)(),{login:o,loading:r}=(0,y.As)(),[i,a]=(0,s.useState)(""),[l,h]=(0,s.useState)(""),[m,x]=(0,s.useState)(""),[g,u]=(0,s.useState)(!1),[p,A]=(0,s.useState)(!1),[f,b]=(0,s.useState)(!1);(0,s.useEffect)((()=>{"true"===new URLSearchParams(t.search).get("expired")&&u(!0)}),[t]);const j=e=>{"admin"===e?(a("admin@example.com"),h("adminpassword")):(a("user@example.com"),h("userpassword"))},S=p||r;return(0,v.jsx)(k.A,{component:"main",maxWidth:"xs",children:(0,v.jsxs)(C.A,{elevation:3,sx:{p:4,mt:8,borderRadius:"8px",boxShadow:"0px 4px 8px rgba(0, 0, 0, 0.1)"},children:[(0,v.jsx)(I.A,{sx:{p:3,mb:3,background:"linear-gradient(45deg, #E33069 30%, #9C27B0 90%)",color:"white",borderRadius:"8px",textAlign:"center"},children:(0,v.jsx)(c.A,{component:"h1",variant:"h5",children:"Login to Your Account"})}),g&&(0,v.jsx)(w.A,{severity:"warning",sx:{mb:3,borderRadius:"8px"},children:"Your session has expired. Please log in again."}),(0,v.jsx)(P,{error:m,onClose:()=>x("")}),(0,v.jsxs)(I.A,{component:"form",onSubmit:async s=>{if(s.preventDefault(),x(""),u(!1),i&&l){A(!0);try{console.log("\ud83d\udce4 Attempting login with:",{email:i});if(!await o(i,l))throw new Error("Login failed");{console.log("\u2705 Login successful.");const{from:o}=t.state||{};e(o||"/flights")}}catch(m){console.error("\u274c Login failed:",m.message),401===m.status?x("Invalid email or password. Please try again."):403===m.status?x("Your account is locked. Please contact support."):navigator.onLine?x(m.message||"Login failed. Please try again."):x("No internet connection. Please check your network and try again.")}finally{A(!1)}}else x("Email and password are required!")},sx:{mt:1},children:[(0,v.jsx)(N.A,{margin:"normal",required:!0,fullWidth:!0,id:"email",label:"Email Address",name:"email",autoComplete:"email",autoFocus:!0,value:i,onChange:e=>a(e.target.value),error:!!m&&!i,disabled:S,sx:{"& .MuiOutlinedInput-root":{borderRadius:"8px",bgcolor:"#F5F8FA"}}}),(0,v.jsx)(N.A,{margin:"normal",required:!0,fullWidth:!0,name:"password",label:"Password",type:"password",id:"password",autoComplete:"current-password",value:l,onChange:e=>h(e.target.value),error:!!m&&!l,disabled:S,sx:{"& .MuiOutlinedInput-root":{borderRadius:"8px",bgcolor:"#F5F8FA"}}}),(0,v.jsx)(d.A,{type:"submit",fullWidth:!0,variant:"contained",sx:{mt:3,mb:2,bgcolor:"#FF7F23","&:hover":{bgcolor:"#E67D2E"},borderRadius:"8px"},disabled:S,children:S?(0,v.jsx)(F.A,{size:24}):"Sign In"}),(0,v.jsx)(d.A,{onClick:()=>e("/register"),fullWidth:!0,variant:"outlined",sx:{mt:1,borderRadius:"8px",borderColor:"#9C27B0",color:"#9C27B0","&:hover":{borderColor:"#7B1FA2",backgroundColor:"rgba(156, 39, 176, 0.04)"}},disabled:S,children:"Don't have an account? Register"}),(0,v.jsx)(d.A,{onClick:()=>b(!f),fullWidth:!0,variant:"text",size:"small",sx:{mt:2,color:"#9C27B0"},disabled:S,children:f?"Hide Test Accounts":"Show Test Accounts"}),f&&(0,v.jsxs)(I.A,{sx:{mt:2,p:2,bgcolor:"#F5F8FA",borderRadius:"8px"},children:[(0,v.jsx)(c.A,{variant:"subtitle2",gutterBottom:!0,children:"Test Accounts (for development)"}),(0,v.jsx)(d.A,{size:"small",onClick:()=>j("admin"),sx:{color:"#9C27B0",mr:1},children:"Use Admin Account"}),(0,v.jsx)(d.A,{size:"small",onClick:()=>j("user"),sx:{color:"#9C27B0"},children:"Use User Account"}),(0,v.jsxs)(c.A,{variant:"caption",display:"block",sx:{mt:1},children:["Admin: admin@example.com / adminpassword",(0,v.jsx)("br",{}),"User: user@example.com / userpassword"]})]})]})]})})};var W=o(57513),T=o(85235),z=o(94018);const O=()=>{const e=(0,n.Zp)(),[t,o]=(0,s.useState)({firstName:"",lastName:"",email:"",password:"",confirmPassword:""}),[r,i]=(0,s.useState)(""),[a,l]=(0,s.useState)(!1),h=e=>{o((0,E.A)((0,E.A)({},t),{},{[e.target.name]:e.target.value}))};return(0,v.jsx)(k.A,{component:"main",maxWidth:"xs",children:(0,v.jsxs)(C.A,{elevation:3,sx:{p:4,mt:8,borderRadius:"8px",boxShadow:"0px 4px 8px rgba(0, 0, 0, 0.1)"},children:[(0,v.jsx)(I.A,{sx:{p:3,mb:3,background:"linear-gradient(45deg, #E33069 30%, #9C27B0 90%)",color:"white",borderRadius:"8px",textAlign:"center"},children:(0,v.jsx)(c.A,{component:"h1",variant:"h5",children:"Create an Account"})}),r&&(0,v.jsx)(c.A,{color:"error",align:"center",sx:{mt:2,p:1,borderRadius:"8px",bgcolor:"rgba(244, 67, 54, 0.1)"},children:r}),(0,v.jsxs)(I.A,{component:"form",onSubmit:async o=>{if(o.preventDefault(),i(""),t.email&&t.password)if(t.password===t.confirmPassword)if(t.password.length<6)i("Password must be at least 6 characters long");else{l(!0);try{console.log("\ud83d\udce4 Sending registration request with:",{email:t.email});const o=await(0,T.DY)(t.email,t.password);console.log("\u2705 Registration successful. User ID:",o.userId),(0,z.T7)(),e("/flights")}catch(r){console.error("\u274c Registration failed:",r.message),i(r.message||"Registration failed. Please try again.")}finally{l(!1)}}else i("Passwords do not match");else i("Email and password are required")},sx:{mt:3},children:[(0,v.jsxs)(W.Ay,{container:!0,spacing:2,children:[(0,v.jsx)(W.Ay,{item:!0,xs:12,sm:6,children:(0,v.jsx)(N.A,{autoComplete:"given-name",fullWidth:!0,name:"firstName",label:"First Name",value:t.firstName,onChange:h,sx:{"& .MuiOutlinedInput-root":{borderRadius:"8px",bgcolor:"#F5F8FA"}}})}),(0,v.jsx)(W.Ay,{item:!0,xs:12,sm:6,children:(0,v.jsx)(N.A,{autoComplete:"family-name",fullWidth:!0,name:"lastName",label:"Last Name",value:t.lastName,onChange:h,sx:{"& .MuiOutlinedInput-root":{borderRadius:"8px",bgcolor:"#F5F8FA"}}})}),(0,v.jsx)(W.Ay,{item:!0,xs:12,children:(0,v.jsx)(N.A,{required:!0,fullWidth:!0,name:"email",label:"Email Address",type:"email",autoComplete:"email",value:t.email,onChange:h,sx:{"& .MuiOutlinedInput-root":{borderRadius:"8px",bgcolor:"#F5F8FA"}}})}),(0,v.jsx)(W.Ay,{item:!0,xs:12,children:(0,v.jsx)(N.A,{required:!0,fullWidth:!0,name:"password",label:"Password",type:"password",autoComplete:"new-password",value:t.password,onChange:h,sx:{"& .MuiOutlinedInput-root":{borderRadius:"8px",bgcolor:"#F5F8FA"}}})}),(0,v.jsx)(W.Ay,{item:!0,xs:12,children:(0,v.jsx)(N.A,{required:!0,fullWidth:!0,name:"confirmPassword",label:"Confirm Password",type:"password",autoComplete:"new-password",value:t.confirmPassword,onChange:h,error:""!==t.confirmPassword&&t.password!==t.confirmPassword,helperText:""!==t.confirmPassword&&t.password!==t.confirmPassword?"Passwords do not match":"",sx:{"& .MuiOutlinedInput-root":{borderRadius:"8px",bgcolor:"#F5F8FA"}}})})]}),(0,v.jsx)(d.A,{type:"submit",fullWidth:!0,variant:"contained",sx:{mt:3,mb:2,bgcolor:"#FF7F23","&:hover":{bgcolor:"#E67D2E"},borderRadius:"8px"},disabled:a,children:a?(0,v.jsx)(F.A,{size:24}):"Register"}),(0,v.jsx)(d.A,{onClick:()=>e("/login"),fullWidth:!0,variant:"outlined",sx:{borderRadius:"8px",borderColor:"#9C27B0",color:"#9C27B0","&:hover":{borderColor:"#7B1FA2",backgroundColor:"rgba(156, 39, 176, 0.04)"}},children:"Already have an account? Login"})]})]})})};var U=o(28896),L=o(7254),_=o(71756),Y=o(29158),H=o(61982),q=o(8161),J=o(83280),V=o(95848),K=o(11035),Z=o(15323),G=o(40975),X=o(95517),$=o(53678),Q=o(85265),ee=o(96534),te=o(52724),oe=o(94690),se=o.n(oe),re=o(94686),ne=o(39474),ie=o(92271);const ae=e=>new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR",maximumFractionDigits:0}).format(e);var le=o(8314),ce=o(25986),de=o(80017),he=o(26855),me=o(67908),xe=o(55988),ge=o(84784),ue=o(98424);const pe=e=>{let{text:t,highlight:o}=e;if(!o.trim())return(0,v.jsx)(v.Fragment,{children:t});const s=o.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),r=new RegExp("(".concat(s,")"),"gi"),n=t.split(r);return(0,v.jsx)(v.Fragment,{children:n.map(((e,t)=>e.toLowerCase()===o.toLowerCase()?(0,v.jsx)("span",{style:{fontWeight:"bold",backgroundColor:"rgba(255, 213, 79, 0.3)"},children:e},t):e))})},Ae={NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}.REACT_APP_BACKEND_URL||"http://localhost:8080",fe=(0,he.Ay)(I.A)((e=>{let{theme:t}=e;return{display:"flex",alignItems:"center",justifyContent:"center",minWidth:"48px",height:"32px",backgroundColor:"#f0f0f0",borderRadius:"4px",marginRight:t.spacing(1.5),padding:t.spacing(0,1),fontWeight:"bold"}})),be=(0,he.Ay)(I.A)((e=>{let{theme:t}=e;return{padding:t.spacing(1.5),display:"flex",alignItems:"flex-start",cursor:"pointer","&:hover":{backgroundColor:t.palette.action.hover}}})),je=e=>{var t;let{label:o,placeholder:r,value:n,onChange:i,disabled:a=!1,required:d=!1,error:h=!1,helperText:m}=e;const[x,g]=(0,s.useState)(!1),[p,A]=(0,s.useState)([]),[f,b]=(0,s.useState)(!1),[j,y]=(0,s.useState)(""),[S,k]=(0,s.useState)(""),[w,E]=(0,s.useState)(null),B=(0,s.useRef)(null);(0,s.useEffect)((()=>{n||(k(""),y(""))}),[n]);const D=(0,s.useCallback)((async e=>{if(!e||e.length<2)return A([]),g(!1),void E(null);b(!0),E(null);try{const t=await fetch("".concat(Ae,"/api/airports/search?query=").concat(encodeURIComponent(e)));if(t.ok){const e=await t.json();A(e),g(e.length>0),0===e.length&&E("No airports found matching your search")}else A([]),g(!1),E("Server error: ".concat(t.status))}catch(h){A([]),g(!1),E("Connection error. Please try again.")}finally{b(!1)}}),[]);return(0,v.jsx)(me.x,{onClickAway:()=>{g(!1)},children:(0,v.jsxs)(I.A,{ref:B,sx:{position:"relative",width:"100%"},children:[(0,v.jsx)(N.A,{fullWidth:!0,label:o,placeholder:r||"Enter city, airport name, or code",value:S,onChange:e=>{const t=e.target.value;y(t),k(t),D(t)},onFocus:()=>j.length>=2&&D(j),disabled:a,required:d,error:!!w||h,helperText:w||m,InputProps:{startAdornment:(0,v.jsx)(xe.A,{position:"start",children:(0,v.jsx)(ue.A,{color:"action"})}),endAdornment:S?(0,v.jsx)(xe.A,{position:"end",children:(0,v.jsx)(l.A,{"aria-label":"clear input",onClick:()=>{k(""),y(""),g(!1),i("")},edge:"end",size:"small",children:(0,v.jsx)(R.A,{fontSize:"small"})})}):null}}),(0,v.jsx)(ge.A,{open:x,anchorEl:B.current,placement:"bottom-start",style:{width:null===(t=B.current)||void 0===t?void 0:t.clientWidth,zIndex:1301},children:(0,v.jsx)(C.A,{elevation:3,sx:{maxHeight:300,overflow:"auto"},children:f?(0,v.jsx)(I.A,{sx:{display:"flex",justifyContent:"center",p:2},children:(0,v.jsx)(F.A,{size:24})}):p.map((e=>(0,v.jsxs)(s.Fragment,{children:[(0,v.jsxs)(be,{onClick:()=>(e=>{const t="".concat(e.code," - ").concat(e.city);k(t),y(t),g(!1),i(e.code,e)})(e),children:[(0,v.jsx)(fe,{children:e.code}),(0,v.jsxs)(I.A,{sx:{overflow:"hidden"},children:[(0,v.jsx)(c.A,{variant:"body1",noWrap:!0,children:(0,v.jsx)(pe,{text:"".concat(e.city).concat(e.state?", "+e.state:"",", ").concat(e.country),highlight:j})}),(0,v.jsx)(c.A,{variant:"body2",color:"text.secondary",noWrap:!0,sx:{mt:.5},children:(0,v.jsx)(pe,{text:e.name,highlight:j})})]})]}),(0,v.jsx)(u.A,{})]},e.id)))})})]})})},ye=[{id:1001,flightNumber:"AI101",airline:"Air India",origin:"DEL",destination:"BOM",departureTime:se()().add(1,"day").set({hour:10,minute:30}).format(),arrivalTime:se()().add(1,"day").set({hour:12,minute:30}).format(),price:5500,seats:Array(60).fill(null).map(((e,t)=>({id:t+1,seatNumber:"".concat(String.fromCharCode(65+Math.floor(t/10))).concat(t%10+1),available:Math.random()>.3}))),apiSourced:!1,originCity:"Delhi",originName:"Indira Gandhi International Airport",destinationCity:"Mumbai",destinationName:"Chhatrapati Shivaji Maharaj International Airport"},{id:1002,flightNumber:"SG202",airline:"SpiceJet",origin:"BLR",destination:"MAA",departureTime:se()().add(1,"day").set({hour:14,minute:45}).format(),arrivalTime:se()().add(1,"day").set({hour:16,minute:0}).format(),price:3200,seats:Array(60).fill(null).map(((e,t)=>({id:t+1,seatNumber:"".concat(String.fromCharCode(65+Math.floor(t/10))).concat(t%10+1),available:Math.random()>.3}))),apiSourced:!1,originCity:"Bangalore",originName:"Kempegowda International Airport",destinationCity:"Chennai",destinationName:"Chennai International Airport"},{id:1003,flightNumber:"UK303",airline:"Vistara",origin:"BOM",destination:"CCU",departureTime:se()().add(2,"day").set({hour:9,minute:15}).format(),arrivalTime:se()().add(2,"day").set({hour:11,minute:45}).format(),price:6800,seats:Array(60).fill(null).map(((e,t)=>({id:t+1,seatNumber:"".concat(String.fromCharCode(65+Math.floor(t/10))).concat(t%10+1),available:Math.random()>.3}))),apiSourced:!1,originCity:"Mumbai",originName:"Chhatrapati Shivaji Maharaj International Airport",destinationCity:"Kolkata",destinationName:"Netaji Subhas Chandra Bose International Airport"},{id:1004,flightNumber:"DM130",airline:"Demo Air",origin:"BOM",destination:"BLR",departureTime:se()().add(3,"day").set({hour:8,minute:17}).format(),arrivalTime:se()().add(3,"day").set({hour:9,minute:17}).format(),price:5656,seats:Array(60).fill(null).map(((e,t)=>({id:t+1,seatNumber:"".concat(String.fromCharCode(65+Math.floor(t/10))).concat(t%10+1),available:Math.random()>.3}))),apiSourced:!1,originCity:"Mumbai",originName:"Chhatrapati Shivaji Maharaj International Airport",destinationCity:"Bangalore",destinationName:"Kempegowda International Airport"}],ve=e=>{let{isAdminView:t=!1}=e;const o=(0,n.Zp)(),[r,i]=(0,s.useState)(se()().add(1,"days")),[a,l]=(0,s.useState)(""),[m,x]=(0,s.useState)(void 0),[g,p]=(0,s.useState)(""),[A,f]=(0,s.useState)(void 0),[b,j]=(0,s.useState)([]),[y,S]=(0,s.useState)(!1),[N,F]=(0,s.useState)(""),[B,D]=(0,s.useState)(!1),[R,P]=(0,s.useState)(!0),[M,z]=(0,s.useState)(!1),[O,oe]=(0,s.useState)(null),he=(0,U.A)(),me=(0,L.A)(he.breakpoints.down("sm")),xe=(0,L.A)(he.breakpoints.between("sm","md")),ge=async e=>{try{const t=b.find((t=>t.id===e));if(!t)return void F("Flight not found");if(se()(t.departureTime).isBefore(se()()))return void F("Cannot book flight ".concat(t.flightNumber," as it has already departed."));if(!t.seats||0===t.seats.filter((e=>e.available)).length)return void F("No seats available for this flight");if(oe(e),F(""),console.log("Starting booking process for flight:",{flightId:t.id,flightNumber:t.flightNumber,apiSourced:t.apiSourced}),t.apiSourced)try{const e=localStorage.getItem("token");if(!e)throw new Error("Authentication required");console.log("Flight is API-sourced, saving to database first");const s=(e=>{var t;console.log("Converting to API Flight type:",{flightId:e.id,flightNumber:e.flightNumber,origin:e.origin,destination:e.destination,seatCount:null===(t=e.seats)||void 0===t?void 0:t.length,apiSourced:e.apiSourced});const o=e.seats.filter((e=>e.available)).length,s={id:e.id,flightNumber:e.flightNumber,origin:e.origin,destination:e.destination,departureTime:e.departureTime,arrivalTime:e.arrivalTime,price:e.price,airline:e.airline||"Unknown Airline",seats:[],apiSourced:!0};return s.availableSeats=o,s})(t),r=new Promise(((e,t)=>{setTimeout((()=>t(new Error("Request timed out after 15 seconds"))),15e3)})),n=await Promise.race([(0,T.wA)(s,e),r]);console.log("Successfully saved API flight, navigating to seat selection:",n),o("/flights/".concat(n.id,"/seats"))}catch(N){console.error("Error saving API flight:",N);let t="Failed to prepare flight for booking.";N instanceof Error&&(t=N.message.includes("timed out")?"Request timed out. Please try again later.":N.message.includes("401")||N.message.includes("Authentication")?"Authentication error. Please log in again.":N.message.includes("403")?"You do not have permission to perform this action.":N.message.includes("404")?"The flight data could not be saved. Flight not found.":N.message.includes("500")?"Server error. Please try again later.":"Failed to prepare flight for booking: ".concat(N.message)),F(t),oe(null)}else console.log("Flight is not API-sourced, navigating directly to seat selection"),o("/flights/".concat(e,"/seats"))}catch(t){console.error("Booking error:",t),t instanceof Error?F("Booking error: ".concat(t.message)):F("An error occurred during booking")}finally{oe(null)}},ue=e=>e.seats?e.seats.filter((e=>e.available)).length:0,pe=e=>{if(e.status)switch(e.status){case"SCHEDULED":return(0,v.jsx)(_.A,{label:"Scheduled",color:"primary",size:"small",sx:{fontWeight:"bold"}});case"IN_FLIGHT":return(0,v.jsx)(_.A,{label:"In Flight",color:"info",size:"small",sx:{fontWeight:"bold"}});case"ARRIVED":return(0,v.jsx)(_.A,{label:"Arrived",color:"success",size:"small",sx:{fontWeight:"bold"}});case"DELAYED":return(0,v.jsx)(_.A,{label:"Delayed",color:"warning",size:"small",sx:{fontWeight:"bold"}});case"CANCELLED":return(0,v.jsx)(_.A,{label:"Cancelled",color:"error",size:"small",sx:{fontWeight:"bold"}})}const t=se()(e.departureTime),o=se()();if(t.isBefore(o))return(0,v.jsx)(_.A,{label:"Departed",color:"default",size:"small",sx:{fontWeight:"bold"}});if((e=>{const t=se()(e),o=se()(),s=t.diff(o,"hours");return s>=0&&s<=2})(e.departureTime))return(0,v.jsx)(_.A,{label:"Departing Soon",color:"warning",size:"small",sx:{fontWeight:"bold"}});const s=ue(e),r=e.seats?e.seats.length:0;return 0===r?(0,v.jsx)(_.A,{label:"Unknown",color:"default",size:"small"}):0===s?(0,v.jsx)(_.A,{label:"Sold Out",color:"error",size:"small"}):s<.2*r?(0,v.jsx)(_.A,{label:"Almost Full",color:"error",size:"small"}):s<.5*r?(0,v.jsx)(_.A,{label:"Filling Up",color:"warning",size:"small"}):(0,v.jsx)(_.A,{label:"Available",color:"success",size:"small"})},Ae=e=>e.apiSourced?(0,v.jsx)(h.A,{title:"External API sourced flight",children:(0,v.jsx)(ie.A,{color:"info"})}):(0,v.jsx)(h.A,{title:"Internal database flight",children:(0,v.jsx)(I.A,{component:"span",sx:{display:"inline-flex"},children:(0,v.jsx)(ne.A,{color:"primary"})})}),fe=(e,t)=>{const o=se()(e),s=se()(t),r=se().duration(s.diff(o)),n=Math.floor(r.asHours()),i=r.minutes();return"".concat(n,"h ").concat(i,"m")},be=(e,t)=>t?"".concat(e," - ").concat(t):e;return(0,v.jsx)(k.A,{maxWidth:!t&&"lg",className:"flight-list",children:(0,v.jsxs)(I.A,{sx:{py:4},children:[!t&&(0,v.jsx)(c.A,{variant:"h4",component:"h1",gutterBottom:!0,children:"Find your perfect flight"}),N&&(0,v.jsx)(w.A,{severity:"error",sx:{mb:3,borderRadius:"8px"},children:N}),(0,v.jsxs)(W.Ay,{container:!0,spacing:2,sx:{mb:4},children:[(0,v.jsx)(W.Ay,{item:!0,xs:12,sm:4,children:(0,v.jsx)(je,{label:"From",value:a,onChange:(e,t)=>{l(e),x(t)},placeholder:"City or airport code",required:!0})}),(0,v.jsx)(W.Ay,{item:!0,xs:12,sm:4,children:(0,v.jsx)(je,{label:"To",value:g,onChange:(e,t)=>{p(e),f(t)},placeholder:"City or airport code",required:!0})}),(0,v.jsx)(W.Ay,{item:!0,xs:12,sm:4,children:(0,v.jsx)(ee.$,{dateAdapter:te.Y,children:(0,v.jsx)(Q.l,{label:"Date",value:r,onChange:e=>i(e),slotProps:{textField:{fullWidth:!0,size:me?"small":"medium",sx:{"& .MuiOutlinedInput-root":{borderRadius:"8px",bgcolor:"#F5F8FA"}}}}})})}),(0,v.jsx)(W.Ay,{item:!0,xs:12,children:(0,v.jsx)(d.A,{variant:"contained",color:"primary",onClick:async()=>{if(a&&g&&r)if(r.isBefore(se()().startOf("day")))F("Cannot search for flights in the past");else{F(""),D(!0),z(!0);try{const e=localStorage.getItem("token");if(!e)throw new Error("Authentication required");try{const t=await re.A.get("http://localhost:8080/api/flights/search",{params:{origin:a,destination:g,departureDate:r.format("YYYY-MM-DD")},headers:{Authorization:"Bearer ".concat(e)}}),o=await Promise.all(t.data.map((async e=>{const t=(0,E.A)((0,E.A)({},e),{},{apiSourced:void 0===e.apiSourced||e.apiSourced});if(!e.originCity||!e.originName)try{const o=await(0,T.CB)(e.origin);o&&(t.originCity=o.city,t.originName=o.name)}catch(o){console.warn("Could not fetch details for origin airport ".concat(e.origin),o)}if(!e.destinationCity||!e.destinationName)try{const o=await(0,T.CB)(e.destination);o&&(t.destinationCity=o.city,t.destinationName=o.name)}catch(o){console.warn("Could not fetch details for destination airport ".concat(e.destination),o)}return t})));if(o.length>0)j(o),P(!0);else{console.log("No flights found in database, using demo flights as fallback"),P(!1);const e=ye.filter((e=>e.origin.toLowerCase().includes(a.toLowerCase())&&e.destination.toLowerCase().includes(g.toLowerCase())&&se()(e.departureTime).isSame(r,"day")));if(0===e.length){const e=m?m.code:a.toUpperCase(),t=A?A.code:g.toUpperCase(),o={id:Math.floor(1e4*Math.random())+2e3,flightNumber:"DM".concat(Math.floor(900*Math.random())+100),airline:["Air India","IndiGo","SpiceJet","Vistara","GoAir"][Math.floor(5*Math.random())],origin:e,destination:t,departureTime:r.clone().set({hour:Math.floor(12*Math.random())+6,minute:[0,15,30,45][Math.floor(4*Math.random())]}).format(),arrivalTime:r.clone().set({hour:Math.floor(12*Math.random())+6,minute:[0,15,30,45][Math.floor(4*Math.random())]}).add(Math.floor(3*Math.random())+1,"hours").format(),price:Math.floor(8e3*Math.random())+3e3,seats:Array(60).fill(null).map(((e,t)=>({id:t+1,seatNumber:"".concat(String.fromCharCode(65+Math.floor(t/10))).concat(t%10+1),available:Math.random()>.3}))),apiSourced:!1,originCity:m?m.city:a,originName:m?m.name:"".concat(a," Airport"),destinationCity:A?A.city:g,destinationName:A?A.name:"".concat(g," Airport")};j([o])}else j(e)}}catch(N){console.error("API error:",N),P(!1);const t=ye.filter((e=>e.origin.toLowerCase().includes(a.toLowerCase())&&e.destination.toLowerCase().includes(g.toLowerCase())&&se()(e.departureTime).isSame(r,"day")));if(0===t.length){const e=m?m.code:a.toUpperCase(),t=A?A.code:g.toUpperCase(),o={id:Math.floor(1e4*Math.random())+2e3,flightNumber:"DM".concat(Math.floor(900*Math.random())+100),airline:["Air India","IndiGo","SpiceJet","Vistara","GoAir"][Math.floor(5*Math.random())],origin:e,destination:t,departureTime:r.clone().set({hour:Math.floor(12*Math.random())+6,minute:[0,15,30,45][Math.floor(4*Math.random())]}).format(),arrivalTime:r.clone().set({hour:Math.floor(12*Math.random())+6,minute:[0,15,30,45][Math.floor(4*Math.random())]}).add(Math.floor(3*Math.random())+1,"hours").format(),price:Math.floor(8e3*Math.random())+3e3,seats:Array(60).fill(null).map(((e,t)=>({id:t+1,seatNumber:"".concat(String.fromCharCode(65+Math.floor(t/10))).concat(t%10+1),available:Math.random()>.3}))),apiSourced:!1,originCity:m?m.city:a,originName:m?m.name:"".concat(a," Airport"),destinationCity:A?A.city:g,destinationName:A?A.name:"".concat(g," Airport")};j([o])}else j(t)}}catch(e){console.error("Error during search:",e),F(e.message||"Error during search"),j([])}finally{D(!1)}}else F("Please fill in all search fields")},disabled:B,fullWidth:me,sx:{mt:1,bgcolor:"#FF7F23","&:hover":{bgcolor:"#E67D2E"},borderRadius:"8px"},children:B?"Searching...":"Search Flights"})})]}),B&&(0,v.jsx)(Y.A,{sx:{mb:3,borderRadius:"4px"}}),M&&!B&&0===b.length&&(0,v.jsx)(w.A,{severity:"info",sx:{borderRadius:"8px"},children:"No flights found for your search criteria. Please try different dates or locations."}),b.length>0&&(0,v.jsxs)(v.Fragment,{children:[(0,v.jsxs)(c.A,{variant:"h6",gutterBottom:!0,children:[b.length," ",1===b.length?"Flight":"Flights"," Available"]}),(me||xe)&&(0,v.jsx)(W.Ay,{container:!0,spacing:2,children:b.map((e=>(0,v.jsx)(W.Ay,{item:!0,xs:12,children:(0,v.jsxs)(H.A,{elevation:0,sx:{mb:2,transition:"transform 0.2s",borderRadius:"8px",boxShadow:"0px 4px 8px rgba(0, 0, 0, 0.1)",p:"0.25rem","&:hover":{transform:"translateY(-4px)",boxShadow:"0px 6px 12px rgba(0, 0, 0, 0.15)"}},children:[(0,v.jsxs)(q.A,{sx:{pb:1,p:"1.25rem"},children:[(0,v.jsxs)(I.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[(0,v.jsxs)(I.A,{sx:{display:"flex",alignItems:"center"},children:[(0,v.jsx)(ne.A,{sx:{mr:1,color:"#E33069",transform:"rotate(45deg)"}}),(0,v.jsxs)(c.A,{variant:"subtitle1",fontWeight:"bold",children:[e.airline," ",e.flightNumber]})]}),pe(e)]}),(0,v.jsxs)(I.A,{sx:{display:"flex",justifyContent:"space-between",mb:2},children:[(0,v.jsxs)(I.A,{children:[(0,v.jsx)(c.A,{variant:"h6",children:be(e.origin,e.originCity)}),(0,v.jsx)(c.A,{variant:"body2",color:"text.secondary",children:se()(e.departureTime).format("h:mm A")}),(0,v.jsx)(c.A,{variant:"caption",color:"text.secondary",children:se()(e.departureTime).format("MMM D, YYYY")})]}),(0,v.jsxs)(I.A,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},children:[(0,v.jsx)(c.A,{variant:"caption",color:"text.secondary",sx:{mb:.5},children:fe(e.departureTime,e.arrivalTime)}),(0,v.jsxs)(I.A,{sx:{display:"flex",alignItems:"center",width:"100%"},children:[(0,v.jsx)(I.A,{sx:{height:1,bgcolor:"grey.400",flex:1}}),(0,v.jsx)(le.A,{sx:{color:"#9C27B0",mx:.5}}),(0,v.jsx)(I.A,{sx:{height:1,bgcolor:"grey.400",flex:1}})]})]}),(0,v.jsxs)(I.A,{sx:{textAlign:"right"},children:[(0,v.jsx)(c.A,{variant:"h6",children:be(e.destination,e.destinationCity)}),(0,v.jsx)(c.A,{variant:"body2",color:"text.secondary",children:se()(e.arrivalTime).format("h:mm A")}),(0,v.jsx)(c.A,{variant:"caption",color:"text.secondary",children:se()(e.arrivalTime).format("MMM D, YYYY")})]})]}),(0,v.jsx)(u.A,{sx:{my:1}}),(0,v.jsxs)(W.Ay,{container:!0,spacing:1,sx:{mt:1},children:[(0,v.jsx)(W.Ay,{item:!0,xs:6,children:(0,v.jsxs)(I.A,{sx:{display:"flex",alignItems:"center"},children:[(0,v.jsx)(ce.A,{fontSize:"small",sx:{mr:.5,color:"#9C27B0"}}),(0,v.jsxs)(c.A,{variant:"body2",children:[ue(e)," seats available"]})]})}),(0,v.jsx)(W.Ay,{item:!0,xs:6,children:(0,v.jsxs)(I.A,{sx:{display:"flex",alignItems:"center",justifyContent:"flex-end"},children:[(0,v.jsx)(de.A,{fontSize:"small",sx:{mr:.5,color:"#FF7F23"}}),(0,v.jsxs)(c.A,{variant:"h6",color:"#FF7F23",children:["\u20b9",ae(e.price)]})]})})]})]}),(0,v.jsx)(J.A,{sx:{px:"1.25rem",pb:"1.25rem",pt:0},children:(0,v.jsx)(d.A,{variant:"contained",fullWidth:!0,onClick:()=>ge(e.id),disabled:O===e.id,sx:{bgcolor:"#FF7F23","&:hover":{bgcolor:"#E67D2E"},borderRadius:"8px"},children:O===e.id?"Processing...":"Select Flight"})})]})},e.id)))}),!me&&!xe&&(0,v.jsx)(V.A,{component:C.A,variant:"outlined",sx:{mt:2,borderRadius:"8px",boxShadow:"0px 4px 8px rgba(0, 0, 0, 0.1)"},children:(0,v.jsxs)(K.A,{"aria-label":"flights table",children:[(0,v.jsx)(Z.A,{sx:{bgcolor:"#F5F8FA"},children:(0,v.jsxs)(G.A,{children:[(0,v.jsx)(X.A,{children:"Flight Number"}),(0,v.jsx)(X.A,{children:"From"}),(0,v.jsx)(X.A,{children:"To"}),(0,v.jsx)(X.A,{children:"Departure"}),(0,v.jsx)(X.A,{children:"Arrival"}),(0,v.jsx)(X.A,{children:"Price (INR)"}),(0,v.jsx)(X.A,{children:"Available Seats"}),(0,v.jsx)(X.A,{children:"Status"}),(0,v.jsx)(X.A,{children:"Source"}),(0,v.jsx)(X.A,{children:"Action"})]})}),(0,v.jsx)($.A,{children:b.map((e=>(0,v.jsxs)(G.A,{hover:!0,sx:{transition:"background-color 0.2s","&:hover":{backgroundColor:"rgba(0, 0, 0, 0.04)"}},children:[(0,v.jsx)(X.A,{children:(0,v.jsxs)(I.A,{sx:{display:"flex",alignItems:"center"},children:[(0,v.jsx)(ne.A,{sx:{mr:1,color:"#E33069",transform:"rotate(45deg)"}}),(0,v.jsxs)(I.A,{children:[(0,v.jsx)(c.A,{variant:"body2",fontWeight:"bold",children:e.flightNumber}),(0,v.jsx)(c.A,{variant:"caption",color:"text.secondary",children:e.airline})]})]})}),(0,v.jsxs)(X.A,{children:[(0,v.jsx)(c.A,{variant:"body2",fontWeight:"medium",children:be(e.origin,e.originCity)}),e.originName&&(0,v.jsx)(c.A,{variant:"caption",color:"text.secondary",display:"block",children:e.originName})]}),(0,v.jsxs)(X.A,{children:[(0,v.jsx)(c.A,{variant:"body2",fontWeight:"medium",children:be(e.destination,e.destinationCity)}),e.destinationName&&(0,v.jsx)(c.A,{variant:"caption",color:"text.secondary",display:"block",children:e.destinationName})]}),(0,v.jsxs)(X.A,{children:[(0,v.jsx)(c.A,{variant:"body2",children:se()(e.departureTime).format("MMM D, YYYY")}),(0,v.jsx)(c.A,{variant:"body2",fontWeight:"bold",children:se()(e.departureTime).format("h:mm A")})]}),(0,v.jsxs)(X.A,{children:[(0,v.jsx)(c.A,{variant:"body2",children:se()(e.arrivalTime).format("MMM D, YYYY")}),(0,v.jsx)(c.A,{variant:"body2",fontWeight:"bold",children:se()(e.arrivalTime).format("h:mm A")})]}),(0,v.jsx)(X.A,{children:(0,v.jsxs)(c.A,{variant:"body2",fontWeight:"bold",color:"#FF7F23",children:["\u20b9",ae(e.price)]})}),(0,v.jsx)(X.A,{children:ue(e)}),(0,v.jsx)(X.A,{children:pe(e)}),(0,v.jsx)(X.A,{children:Ae(e)}),(0,v.jsx)(X.A,{children:(0,v.jsx)(d.A,{variant:"contained",size:"small",onClick:()=>ge(e.id),disabled:O===e.id,sx:{bgcolor:"#FF7F23","&:hover":{bgcolor:"#E67D2E"},borderRadius:"8px"},children:O===e.id?"Processing...":"Select"})})]},e.id)))})]})})]})]})})};var Se=o(61126),ke=o(62856),Ce=o(19632),Ie=o(63696),we=o(4765),Ne=o(20623),Fe=o(96425),Ee=o.n(Fe);const Be=new class{constructor(){this.client=null,this.subscriptions=new Map,this.connectionPromise=null,this.reconnectAttempts=0,this.maxReconnectAttempts=10,this.reconnectDelay=1e3,this._connected=!1,this.userId=void 0;const e=localStorage.getItem("token"),t=this.getUserIdFromToken(e);if(t)this.userId="auth_user_".concat(t),localStorage.setItem("websocket_user_id",this.userId),console.log("[WebSocket] Using authenticated user ID:",this.userId);else{const e=localStorage.getItem("websocket_user_id");e?this.userId=e:(this.userId="user_"+Date.now()+"_"+Math.random().toString(36).substring(2,9),localStorage.setItem("websocket_user_id",this.userId)),console.log("[WebSocket] Using anonymous user ID:",this.userId)}this.initializeConnection(),window.addEventListener("storage",(e=>{"token"===e.key&&this.updateUserIdFromToken()}))}getUserIdFromToken(e){if(!e)return null;try{const t=e.split(".")[1].replace(/-/g,"+").replace(/_/g,"/"),o=decodeURIComponent(atob(t).split("").map((function(e){return"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)})).join("")),s=JSON.parse(o);return s.sub||s.user_id||s.id||null}catch(t){return console.error("[WebSocket] Error extracting user ID from token:",t),null}}updateUserIdFromToken(){const e=localStorage.getItem("token"),t=this.getUserIdFromToken(e);if(t){const e="auth_user_".concat(t);this.userId!==e&&(console.log("[WebSocket] User ID changed, reconnecting..."),this.userId=e,localStorage.setItem("websocket_user_id",this.userId),this.forceReconnect())}}get isConnected(){return this._connected}connect(){return this.initializeConnection()}forceReconnect(){return console.log("[WebSocket] Forcing reconnect..."),this.client&&this._connected&&(this.client.deactivate(),this._connected=!1),this.connectionPromise=null,this.initializeConnection()}initializeConnection(){return this.connectionPromise||(console.log("[WebSocket] Initializing connection..."),this.client=new Ne.K({webSocketFactory:()=>new(Ee())("http://localhost:8080/ws"),debug:e=>{0},reconnectDelay:this.reconnectDelay,heartbeatIncoming:1e4,heartbeatOutgoing:1e4}),this.connectionPromise=new Promise(((e,t)=>{if(!this.client)return t("Client not initialized");this.client.onConnect=t=>{console.log("[WebSocket] Connected!",t);const o=!this._connected;if(this._connected=!0,this.reconnectAttempts=0,this.reconnectDelay=1e3,this.resubscribeAll(),o){const e=new CustomEvent("webSocketReconnected");document.dispatchEvent(e)}e()},this.client.onStompError=e=>{console.error("[WebSocket] STOMP error",e),this._connected=!1,t(e)},this.client.onWebSocketClose=()=>{console.log("[WebSocket] Connection closed"),this._connected=!1,this.handleReconnect()},this.client.activate()}))),this.connectionPromise}handleReconnect(){if(this.reconnectAttempts>=this.maxReconnectAttempts)return void console.error("[WebSocket] Max reconnection attempts reached");this.reconnectAttempts++;const e=Math.min(3e4,this.reconnectDelay*Math.pow(2,this.reconnectAttempts-1));console.log("[WebSocket] Attempting to reconnect in ".concat(e/1e3," seconds... (").concat(this.reconnectAttempts,"/").concat(this.maxReconnectAttempts,")")),this.connectionPromise=null,setTimeout((()=>{this._connected||this.initializeConnection()}),e)}resubscribeAll(){console.log("[WebSocket] Resubscribing to all topics");const e=new Map(this.subscriptions);this.subscriptions.clear(),e.forEach(((e,t)=>{let{callback:o}=e;if(console.log("[WebSocket] Resubscribing to:",t),this.client){const e=this.client.subscribe(t,(e=>{try{const t=JSON.parse(e.body);o(t)}catch(t){console.error("[WebSocket] Error parsing message:",t)}}));this.subscriptions.set(t,{subscription:e,callback:o})}}))}async subscribeSeatUpdates(e,t){try{await this.ensureConnection();const o="/topic/flight/".concat(e,"/seats");if(!this.subscriptions.has(o)&&this.client){const e=this.client.subscribe(o,(e=>{try{const o=JSON.parse(e.body);t(o)}catch(o){console.error("[WebSocket] Error parsing seat update:",o)}}));this.subscriptions.set(o,{subscription:e,callback:t})}return!0}catch(o){return console.error("[WebSocket] Failed to subscribe:",o),!1}}unsubscribeSeatUpdates(e){const t="/topic/flight/".concat(e,"/seats"),o=this.subscriptions.get(t);o&&(o.subscription.unsubscribe(),this.subscriptions.delete(t))}async ensureConnection(){if(!this._connected||!this.connectionPromise){const e=12e4,t=localStorage.getItem("websocket_last_connect"),o=Date.now();if(t&&o-parseInt(t)>e)return console.log("[WebSocket] Connection might be stale, forcing reconnect"),this.forceReconnect();this.connectionPromise=this.initializeConnection(),localStorage.setItem("websocket_last_connect",o.toString())}return this.connectionPromise}async selectSeat(e){return this.sendMessage("/app/seats/hold",(0,E.A)((0,E.A)({},e),{},{userId:this.userId}))}async releaseSeat(e){return this.sendMessage("/app/seats/release",(0,E.A)((0,E.A)({},e),{},{userId:this.userId}))}async holdSeat(e){return this.sendMessage("/app/seats/hold",(0,E.A)((0,E.A)({},e),{},{userId:this.userId}))}async sendMessage(e,t){try{return await this.ensureConnection(),this.client&&this._connected?(this.client.publish({destination:e,body:JSON.stringify(t)}),!0):(console.warn("[WebSocket] Cannot send message, not connected"),!1)}catch(o){return console.error("[WebSocket] Failed to send message to ".concat(e,":"),o),!1}}disconnect(){this.client&&(this.subscriptions.forEach((e=>{let{subscription:t}=e;return t.unsubscribe()})),this.subscriptions.clear(),this.client.deactivate(),this.client=null,this.connectionPromise=null,this.reconnectAttempts=0,this._connected=!1,console.log("[WebSocket] Disconnected"))}};var De=o(11699);const Re="seat_selection_update",Pe=e=>{let{flightId:t,onSeatSelect:o,selectedSeats:r=[]}=e;const[n,i]=(0,s.useState)([]),[a,l]=(0,s.useState)(!0),[h,m]=(0,s.useState)(null),[x,g]=(0,s.useState)(!1),[u,p]=(0,s.useState)(0),[A,f]=(0,s.useState)(0),[b,j]=(0,s.useState)(null),[y,S]=(0,s.useState)(new Set),[k,N]=(0,s.useState)(Date.now()),[B,D]=(0,s.useState)(0),R=(e,o)=>{try{const s=Date.now();if(s-B<500)return;D(s);const r={flightId:t,seatId:e,action:o,timestamp:s};localStorage.setItem(Re,JSON.stringify(r)),setTimeout((()=>{localStorage.removeItem(Re)}),100),console.log("[SeatSync] Broadcasting ".concat(o," for seat ").concat(e," on flight ").concat(t))}catch(h){console.error("[SeatSync] Error broadcasting seat update:",h)}};(0,s.useEffect)((()=>{const e=e=>{if(e.key===Re&&e.newValue)try{const o=JSON.parse(e.newValue);o.flightId===t&&(console.log("[SeatSync] Received ".concat(o.action," for seat ").concat(o.seatId," from another tab")),P())}catch(h){console.error("[SeatSync] Error processing seat update from storage:",h)}};return window.addEventListener("storage",e),()=>{window.removeEventListener("storage",e)}}),[t]),(0,s.useEffect)((()=>{console.log("SeatSelection: Forcing WebSocket reconnect for better real-time updates"),Be.forceReconnect().then((()=>{console.log("SeatSelection: WebSocket reconnected successfully")})).catch((e=>{console.error("SeatSelection: WebSocket reconnect failed:",e)}));const e=setInterval((()=>{M()}),5e3);return()=>{clearInterval(e)}}),[]),(0,s.useEffect)((()=>{if(t){const e=e=>{if(e.flightId===t){if(console.log("WebSocket: Received seat update:",e),i((t=>t.map((t=>{if(t.id===e.seatId){const o="CONFIRMED"===e.status;if("HOLD_EXPIRED"===e.status||"FIXED_INCONSISTENCY"===e.status){const e=t.seatNumber;setTimeout((()=>{m("Seat ".concat(e," hold time expired and is now available for booking.")),j("Seat ".concat(e," is now available for booking!"))}),100)}return(0,E.A)((0,E.A)({},t),{},{available:e.available,booked:o})}return t})))),("RELEASED"===e.status||"HOLD_EXPIRED"===e.status)&&r.includes(e.seatId)){var s;const t=(null===(s=n.find((t=>t.id===e.seatId)))||void 0===s?void 0:s.seatNumber)||"";o&&o(e.seatId,t)}P()}};return console.log("Subscribing to seat updates for flight ".concat(t)),Be.subscribeSeatUpdates(t,e),()=>{console.log("Unsubscribing from seat updates for flight ".concat(t)),Be.unsubscribeSeatUpdates(t)}}}),[t,n]);const P=async()=>{try{const e=localStorage.getItem("token");if(!e)return;console.log("Verifying all seats with latest server data");const o=await(0,T.rN)(t.toString(),e);i((e=>e.map((e=>{const t=o.find((t=>t.id===e.id));return t?r.includes(e.id)?(0,E.A)((0,E.A)({},t),{},{available:!1}):t:e}))))}catch(e){console.error("Error verifying all seats:",e)}};(0,s.useEffect)((()=>{if(Date.now()-A<2e3)return;(async()=>{f(Date.now());try{const s=localStorage.getItem("token");if(!s)return;const a=await(0,T.rN)(t.toString(),s);console.log("Verifying selected seats with server data");const l=r.filter((e=>{const t=a.find((t=>t.id===e));return!t||!0===t.booked}));if(l.length>0){console.warn("Some selected seats are no longer available:",l);for(const t of l){var e;const s=(null===(e=n.find((e=>e.id===t)))||void 0===e?void 0:e.seatNumber)||"";o&&s&&(console.log("Auto-removing unavailable seat ".concat(t," (").concat(s,") from selection")),o(t,s),m("Seat ".concat(s," is no longer available and has been removed from your selection.")))}}i((e=>{const t=r.filter((e=>!l.includes(e)));return a.map((e=>t.includes(e.id)?(0,E.A)((0,E.A)({},e),{},{available:!1}):e))}))}catch(s){console.error("Error verifying seat status:",s)}})()}),[r,t,A,n]);const M=async()=>{try{const e=localStorage.getItem("token");if(!e)return;console.log("Refreshing all seats data from server");const o=await(0,T.rN)(t.toString(),e);i((e=>o.map((e=>r.includes(e.id)?(0,E.A)((0,E.A)({},e),{},{available:!1}):e)))),N(Date.now())}catch(e){console.error("Error refreshing seats:",e)}};(0,s.useEffect)((()=>{(async()=>{l(!0),m(null);try{const e=localStorage.getItem("token");if(!e)throw new Error("Authentication required");const o=await(0,T.rN)(t.toString(),e);console.log("Fetched ALL seats:",o.length),p(o.length);const s=o.map((e=>r.includes(e.id)?(0,E.A)((0,E.A)({},e),{},{available:!1}):e));i(s)}catch(e){m("Failed to load seats. Please try again later."),console.error("Seat loading error:",e)}finally{l(!1)}})()}),[t,r]),(0,s.useEffect)((()=>{0!==n.length&&Math.abs(n.length-u)>5&&console.log("Significant change in seats state:",n.length,"seats")}),[n,u]),(0,s.useEffect)((()=>{r.length>0&&console.log("Selected seats updated:",r)}),[r]),(0,s.useEffect)((()=>{if(u>0&&!a&&n.length<u){console.warn("Seat count decreased from ".concat(u," to ").concat(n.length,". Refetching ALL seats..."));(async()=>{try{const e=localStorage.getItem("token");if(!e)return;const o=await(0,T.rN)(t.toString(),e);console.log("Refetched ALL seats:",o.length);const s=o.map((e=>r.includes(e.id)?(0,E.A)((0,E.A)({},e),{},{available:!1}):e));i(s)}catch(e){console.error("Error refetching seats:",e)}})()}else!a&&n.length>0&&0===u&&(p(n.length),console.log("Initial seat count set to:",n.length))}),[n.length,a,u,t,r]),(0,s.useEffect)((()=>{const e=Date.now();if(e-k>1e4&&0===y.size){(async()=>{try{const o=localStorage.getItem("token");if(!o)return;console.log("Performing periodic refresh of seat data"),N(e);const s=(await(0,T.rN)(t.toString(),o)).map((e=>r.includes(e.id)?(0,E.A)((0,E.A)({},e),{},{available:!1}):e));i(s)}catch(o){console.error("Error in periodic refresh:",o)}})()}}),[n,t,r,k,y]),(0,s.useEffect)((()=>{const e=async()=>{try{const e=localStorage.getItem("token");if(!e)return;console.log("Performing deep seat synchronization...");const s=await(0,T.rN)(t.toString(),e);let a=!1;const l=new Map;s.forEach((e=>{l.set(e.id,e)})),n.forEach((e=>{const t=l.get(e.id);t&&(r.includes(e.id)?t.booked!==e.booked&&(console.warn("Our selected seat ".concat(e.seatNumber," (").concat(e.id,") has been booked by someone else!")),a=!0):t.available===e.available&&t.booked===e.booked||(console.log("Seat ".concat(e.seatNumber," (").concat(e.id,") status changed from server")),a=!0))})),a&&(console.log("Seat status changes detected from server, syncing..."),i((e=>s.map((e=>r.includes(e.id)?e.booked?(setTimeout((()=>{var t;const s=(null===(t=n.find((t=>t.id===e.id)))||void 0===t?void 0:t.seatNumber)||"";o&&s&&(o(e.id,s),m("Seat ".concat(s," was booked by another user and has been removed from your selection.")))}),100),e):(0,E.A)((0,E.A)({},e),{},{available:!1}):e)))))}catch(e){console.error("Error syncing seats:",e)}};e();const s=setInterval(e,5e3);return()=>clearInterval(s)}),[t,r]);const W=e=>{const s=r.includes(e.id),a=!0===e.booked,l=s||!e.available&&!a;let d="available",h="";a?(d="booked",h=""):e.available||s?l&&(d="selected",h=""):(d="held",h="");const x=e.available||s,u=x?()=>(async(e,s)=>{if(y.has(e))console.warn("Ignoring click on seat ".concat(e,", operation already in progress"));else{g(!0),m(null),S((t=>new Set([...Array.from(t),e])));try{const l=r.includes(e);console.log("Clicking seat ".concat(e," (").concat(s,"), currently selected: ").concat(l));const c=n.find((t=>t.id===e));if(!c)return console.warn("Seat ".concat(e," not found in seats array before operation")),m("Seat ".concat(s," information could not be found. Please refresh the page.")),S((t=>{const o=new Set(t);return o.delete(e),o})),void g(!1);if(!l&&(!c.available||c.booked))return console.warn("Attempting to select unavailable seat ".concat(e)),m("Seat ".concat(s," is not available for selection")),S((t=>{const o=new Set(t);return o.delete(e),o})),void g(!1);let d=!1;if(l){console.log("Releasing seat ".concat(e," via WebSocket")),i((t=>t.map((t=>t.id===e?(0,E.A)((0,E.A)({},t),{},{available:!0}):t))));try{if(d=await Be.releaseSeat({seatId:e,flightId:t}),d&&R(e,"release"),!d)return console.error("WebSocket seat release failed for seat ".concat(e)),m("Failed to release seat ".concat(s,". Please try again.")),i((t=>t.map((t=>t.id===e?(0,E.A)((0,E.A)({},t),{},{available:!1}):t)))),S((t=>{const o=new Set(t);return o.delete(e),o})),void g(!1);console.log("Successfully released seat ".concat(e," via WebSocket"))}catch(a){return console.error("Error releasing seat:",a),m("Failed to release seat ".concat(s,": ").concat(a instanceof Error?a.message:"Unknown error")),i((t=>t.map((t=>t.id===e?(0,E.A)((0,E.A)({},t),{},{available:!1}):t)))),S((t=>{const o=new Set(t);return o.delete(e),o})),void g(!1)}}else{console.log("Selecting seat ".concat(e," via WebSocket")),i((t=>t.map((t=>t.id===e?(0,E.A)((0,E.A)({},t),{},{available:!1}):t))));try{if(d=await Be.selectSeat({seatId:e,flightId:t}),d&&R(e,"select"),!d)return console.error("WebSocket seat selection failed for seat ".concat(e)),m("Failed to select seat ".concat(s,". Please try again.")),i((t=>t.map((t=>t.id===e?(0,E.A)((0,E.A)({},t),{},{available:!0}):t)))),S((t=>{const o=new Set(t);return o.delete(e),o})),void g(!1);console.log("Successfully selected seat ".concat(e," via WebSocket"))}catch(a){return console.error("Error selecting seat:",a),m("Failed to select seat ".concat(s,": ").concat(a instanceof Error?a.message:"Unknown error")),i((t=>t.map((t=>t.id===e?(0,E.A)((0,E.A)({},t),{},{available:!0}):t)))),S((t=>{const o=new Set(t);return o.delete(e),o})),void g(!1)}}o&&o(e,s),f(0)}catch(a){const e=a instanceof Error?a.message:"Failed to process seat";m(e),console.error("Seat operation error:",a)}finally{S((t=>{const o=new Set(t);return o.delete(e),o})),g(!1)}}})(e.id,e.seatNumber):void 0;return(0,v.jsxs)(I.A,{"data-seat-id":e.id,onClick:u,sx:{width:{xs:30,sm:36,md:40},height:{xs:30,sm:36,md:40},m:{xs:.3,sm:.4,md:.5},display:"flex",alignItems:"center",justifyContent:"center",cursor:x?"pointer":"not-allowed",borderRadius:"4px 4px 0 0",transition:"all 0.2s",backgroundColor:"booked"===d?"error.light":"held"===d?"warning.light":"selected"===d?"primary.light":"background.paper",color:"available"===d?"text.primary":"white",boxShadow:"0 2px 3px rgba(0,0,0,0.1)",position:"relative",fontWeight:"bold",fontSize:{xs:11,sm:12,md:14},"&:hover":{transform:x?"translateY(-2px)":"none",boxShadow:x?"0 4px 6px rgba(0,0,0,0.15)":"0 2px 3px rgba(0,0,0,0.1)"},"&:before":{content:'""',position:"absolute",bottom:-8,left:0,width:"100%",height:8,backgroundColor:"booked"===d?"error.dark":"held"===d?"warning.dark":"selected"===d?"primary.dark":"grey.400",borderRadius:"0 0 4px 4px"},"&:after":{content:'""',position:"absolute",bottom:-3,left:"15%",width:"70%",height:1,backgroundColor:"rgba(255,255,255,0.5)"}},children:[e.seatNumber,h&&(0,v.jsx)(c.A,{variant:"caption",component:"div",sx:{fontSize:{xs:"6px",sm:"7px",md:"8px"},position:"absolute",bottom:-16,width:"100%",textAlign:"center",fontWeight:"bold",color:"text.secondary"},children:h})]},e.id)};return(0,v.jsxs)(C.A,{elevation:3,sx:{p:{xs:1,sm:2,md:3},maxWidth:"100%",margin:"auto",overflowX:"auto"},children:[(0,v.jsx)(c.A,{variant:"h5",gutterBottom:!0,align:"center",children:"Select Your Seat"}),h&&(0,v.jsx)(w.A,{severity:"error",sx:{mb:2},children:h}),b&&(0,v.jsx)(we.A,{open:!!b,autoHideDuration:6e3,onClose:()=>j(null),message:b}),a?(0,v.jsx)(I.A,{sx:{display:"flex",justifyContent:"center",p:3},children:(0,v.jsx)(F.A,{})}):(0,v.jsxs)(I.A,{sx:{width:"100%",overflowX:"auto",display:"flex",flexDirection:"column",alignItems:"center"},children:[(0,v.jsx)(c.A,{variant:"body2",gutterBottom:!0,align:"center",children:"Please select your preferred seat from the available options below."}),(()=>{const e=n.reduce(((e,t)=>{const o=t.seatNumber.charAt(0);return e[o]||(e[o]=[]),e[o].push(t),e}),{});return(0,v.jsxs)(I.A,{sx:{display:"flex",flexDirection:"column",alignItems:"center",width:"100%",overflowX:"auto"},children:[(0,v.jsx)(I.A,{sx:{width:"60px",height:"80px",bgcolor:"grey.300",borderRadius:"50% 50% 0 0",mb:4,display:{xs:"none",sm:"block"}}}),(0,v.jsx)(I.A,{sx:{bgcolor:"grey.100",borderRadius:"10px",p:{xs:1,sm:2,md:3},width:{xs:"95%",sm:"90%",md:"80%"},maxWidth:"800px"},children:Object.keys(e).sort().map((t=>{const o=[...e[t]].sort(((e,t)=>parseInt(e.seatNumber.substring(1))-parseInt(t.seatNumber.substring(1)))),s=Math.ceil(o.length/2),r=o.slice(0,s),n=o.slice(s);return(0,v.jsxs)(I.A,{sx:{display:"flex",alignItems:"center",mb:{xs:2,sm:3},justifyContent:"center",width:"100%"},children:[(0,v.jsx)(c.A,{variant:"subtitle2",sx:{width:{xs:20,sm:30},textAlign:"center",mr:{xs:.5,sm:1},fontWeight:"bold"},children:t}),(0,v.jsx)(I.A,{sx:{display:"flex"},children:r.map((e=>W(e)))}),(0,v.jsx)(I.A,{sx:{width:{xs:12,sm:16,md:20},mx:{xs:.5,sm:1,md:2},height:4,bgcolor:"grey.300",alignSelf:"center"}}),(0,v.jsx)(I.A,{sx:{display:"flex"},children:n.map((e=>W(e)))})]},t)}))})]})})(),(0,v.jsxs)(I.A,{sx:{mt:3,display:"flex",justifyContent:"center",flexWrap:"wrap",gap:{xs:1,sm:2},maxWidth:"100%"},children:[(0,v.jsxs)(I.A,{sx:{display:"flex",alignItems:"center"},children:[(0,v.jsx)(I.A,{sx:{width:16,height:16,backgroundColor:"background.paper",position:"relative",borderRadius:"4px 4px 0 0","&:before":{content:'""',position:"absolute",bottom:-4,left:0,width:"100%",height:4,backgroundColor:"grey.400",borderRadius:"0 0 4px 4px"}}}),(0,v.jsx)(c.A,{variant:"caption",sx:{ml:1},children:"Available"})]}),(0,v.jsxs)(I.A,{sx:{display:"flex",alignItems:"center"},children:[(0,v.jsx)(I.A,{sx:{width:16,height:16,backgroundColor:"primary.light",position:"relative",borderRadius:"4px 4px 0 0","&:before":{content:'""',position:"absolute",bottom:-4,left:0,width:"100%",height:4,backgroundColor:"primary.dark",borderRadius:"0 0 4px 4px"}}}),(0,v.jsx)(c.A,{variant:"caption",sx:{ml:1},children:"Selected"})]}),(0,v.jsxs)(I.A,{sx:{display:"flex",alignItems:"center"},children:[(0,v.jsx)(I.A,{sx:{width:16,height:16,backgroundColor:"warning.light",position:"relative",borderRadius:"4px 4px 0 0","&:before":{content:'""',position:"absolute",bottom:-4,left:0,width:"100%",height:4,backgroundColor:"warning.dark",borderRadius:"0 0 4px 4px"}}}),(0,v.jsx)(c.A,{variant:"caption",sx:{ml:1},children:"Held (expires in 3 min)"})]}),(0,v.jsxs)(I.A,{sx:{display:"flex",alignItems:"center"},children:[(0,v.jsx)(I.A,{sx:{width:16,height:16,backgroundColor:"error.light",position:"relative",borderRadius:"4px 4px 0 0","&:before":{content:'""',position:"absolute",bottom:-4,left:0,width:"100%",height:4,backgroundColor:"error.dark",borderRadius:"0 0 4px 4px"}}}),(0,v.jsx)(c.A,{variant:"caption",sx:{ml:1},children:"Booked"})]})]}),(0,v.jsxs)(I.A,{sx:{display:"flex",justifyContent:"center",mt:3,flexWrap:{xs:"wrap",sm:"nowrap"},gap:1},children:[(0,v.jsx)(d.A,{variant:"outlined",color:"primary",onClick:M,startIcon:(0,v.jsx)(De.A,{}),disabled:x,size:"small",sx:{px:{xs:1,sm:2},py:{xs:.5,sm:1}},children:"Refresh Seats"}),(0,v.jsx)(d.A,{variant:"contained",color:"primary",onClick:()=>P(),disabled:x,size:"small",sx:{px:{xs:1,sm:2},py:{xs:.5,sm:1}},children:"Verify Selection"})]})]})]})},Me="selected_seats_for_flight_",We=()=>{const{flightId:e=""}=(0,n.g)(),t=(0,n.Zp)(),[o,r]=(0,s.useState)([]),[i,a]=(0,s.useState)([]),[l,h]=(0,s.useState)(!0),[m,x]=(0,s.useState)(null),[g,p]=(0,s.useState)(null),[A,f]=(0,s.useState)(!1),[b,j]=(0,s.useState)([]),[y,S]=(0,s.useState)({}),[B,D]=(0,s.useState)(null),[R,M]=(0,s.useState)(!1),[z,O]=(0,s.useState)(!1),[U,L]=(0,s.useState)(Date.now()),Y=parseInt(e,10),H="".concat(Me).concat(e),q="".concat(Me).concat(e,"_numbers");(0,s.useEffect)((()=>{try{const e=sessionStorage.getItem(H),t=sessionStorage.getItem(q);if(e){const t=JSON.parse(e);Array.isArray(t)&&(r(t),console.log("Loaded selected seats from storage:",t))}if(t){const e=JSON.parse(t);Array.isArray(e)&&(a(e),console.log("Loaded selected seat numbers from storage:",e))}}catch(m){console.error("Error loading seats from sessionStorage:",m)}}),[e,H,q]),(0,s.useEffect)((()=>{try{sessionStorage.setItem(H,JSON.stringify(o)),sessionStorage.setItem(q,JSON.stringify(i)),console.log("Saved selected seats to storage:",o)}catch(m){console.error("Error saving seats to sessionStorage:",m)}}),[o,i,H,q]),(0,s.useEffect)((()=>{const e=setInterval((()=>{const e=Date.now();if(!(e-U<2e3))try{const t=sessionStorage.getItem(H);if(t){const e=JSON.parse(t);JSON.stringify(e)!==JSON.stringify(o)&&(console.log("Detected seat selection change from another tab, updating..."),r(e))}const s=sessionStorage.getItem(q);if(s){const e=JSON.parse(s);JSON.stringify(e)!==JSON.stringify(i)&&a(e)}L(e)}catch(m){console.error("Error checking for updates:",m)}}),1e3);return()=>clearInterval(e)}),[o,i,U,H,q]),(0,s.useEffect)((()=>{(async()=>{h(!0);try{const o=localStorage.getItem("token");if(!o)return x("Authentication required"),void t("/login");const s=await re.A.get("http://localhost:8080/api/flights/".concat(e),{headers:{Authorization:"Bearer ".concat(o)}});D(s.data),M(!0===s.data.apiSourced),O(!0)}catch(o){console.error("Error checking flight:",o),x("Could not retrieve flight information. Please try again.");try{const e=sessionStorage.getItem("searchResults");if(e){const t=JSON.parse(e).find((e=>e.id===Y));t&&t.apiSourced&&(D(t),M(!0),O(!1),x(null))}}catch(s){console.error("Error checking session storage:",s)}}finally{h(!1)}})()}),[e,t,Y]),(0,s.useEffect)((()=>{(async()=>{if(B&&R&&!z){h(!0),x(null);try{const o=localStorage.getItem("token");if(!o)return x("Authentication required"),void t("/login");const s=await(0,T.wA)(B,o);if(console.log("API flight saved or found in database:",s),!s||!s.id)throw new Error("Failed to save flight to database");s.id.toString()!==e?(console.log("Redirecting from temporary ID ".concat(e," to permanent flight ID ").concat(s.id)),t("/flights/".concat(s.id,"/seats"),{replace:!0})):(console.log("Already on the correct flight page, no redirect needed"),O(!0),D(s))}catch(o){console.error("Error saving API flight to database:",o),x("Failed to prepare flight for booking. Please try searching again.")}finally{h(!1)}}})()}),[B,R,z,t,e]),(0,s.useEffect)((()=>{if(o.length>0){const e=o.map(((e,t)=>{const o=b.find((t=>t.seatId===e));return o||{firstName:"",lastName:"",email:"",phone:"",age:"",seatId:e,seatNumber:i[t]||"Unknown"}}));j(e)}else j([])}),[o,i]);const J=(e,t)=>{try{if(o.includes(e)){const s=o.filter((t=>t!==e)),n=i.filter((e=>e!==t));r(s),a(n),sessionStorage.setItem(H,JSON.stringify(s)),sessionStorage.setItem(q,JSON.stringify(n)),p("Seat ".concat(t," removed from selection"))}else{if(o.length>=10)return void x("You can only select up to 10 seats at once.");const s=[...o,e],n=[...i,t];r(s),a(n),sessionStorage.setItem(H,JSON.stringify(s)),sessionStorage.setItem(q,JSON.stringify(n)),p("Seat ".concat(t," added to selection"))}}catch(s){console.error("Error handling seat selection:",s),x("Failed to update seat selection. Please try again.")}},V=()=>{const e={};let t=!0;return b.forEach(((o,s)=>{const r="passenger-".concat(s);o.firstName.trim()||(e["".concat(r,"-firstName")]="First name is required",t=!1),o.lastName.trim()||(e["".concat(r,"-lastName")]="Last name is required",t=!1),o.email&&!o.email.match(/^[^\s@]+@[^\s@]+\.[^\s@]+$/)&&(e["".concat(r,"-email")]="Please enter a valid email address",t=!1),o.phone&&!o.phone.match(/^[0-9+\-\s()]{7,20}$/)&&(e["".concat(r,"-phone")]="Please enter a valid phone number",t=!1),o.age&&(isNaN(Number(o.age))||Number(o.age)<0||Number(o.age)>120)&&(e["".concat(r,"-age")]="Please enter a valid age (0-120)",t=!1)})),S(e),t},K=()=>{b.some((e=>e.firstName.trim()||e.lastName.trim()||e.email.trim()||e.phone.trim()||e.age))&&0===Object.keys(y).length?window.confirm("Are you sure you want to close? Your passenger information will be saved.")&&f(!1):f(!1)},Z=async()=>{try{if(0===o.length)return void x("Please select at least one seat to proceed.");if(!V())return void f(!0);h(!0),x(null);const r=localStorage.getItem("token");if(!r)return x("You must be logged in to book seats."),void h(!1);try{const s=b.map((e=>({firstName:e.firstName.trim(),lastName:e.lastName.trim(),email:e.email.trim()||void 0,phone:e.phone.trim()||void 0,age:e.age?parseInt(e.age,10):void 0,seatId:e.seatId})));console.log("Creating booking for seats:",o);const n=await(0,T.sH)(e,o,r,s);if(!n||!n.id)throw new Error("Invalid booking response");console.log("Booking created successfully:",n),t("/booking-confirmation/".concat(n.id))}catch(s){console.error("Error creating booking:",s),400===s.status?x("One or more seats are no longer available. Please refresh and try again."):401===s.status?(x("Your session has expired. Please log in again."),setTimeout((()=>t("/login?expired=true")),2e3)):navigator.onLine?x(s.message||"Failed to create booking. Please try again."):x("No internet connection. Please check your network and try again."),h(!1)}}catch(r){x("Failed to process booking: "+(r.message||"Unknown error")),console.error("Booking error:",r),h(!1)}},G=(e,t)=>y["passenger-".concat(e,"-").concat(t)],X=(e,t,o)=>{j((s=>s.map(((s,r)=>{if(s.seatId===e){const e="passenger-".concat(r,"-").concat(t);if(y[e]){const t=(0,E.A)({},y);delete t[e],S(t)}return(0,E.A)((0,E.A)({},s),{},{[t]:o})}return s}))))};return(0,v.jsx)(k.A,{maxWidth:"md",children:(0,v.jsxs)(C.A,{sx:{p:3,mt:3,position:"relative"},children:[(0,v.jsx)(P,{error:m,onClose:()=>x(null)}),o.length>0&&(0,v.jsxs)(I.A,{sx:{mb:3,p:2,bgcolor:"#f5f5f5",borderRadius:1},children:[(0,v.jsxs)(c.A,{variant:"subtitle1",gutterBottom:!0,children:["Selected Seats (",o.length,"):"]}),(0,v.jsx)(I.A,{sx:{display:"flex",flexWrap:"wrap",gap:1},children:i.map(((e,t)=>(0,v.jsx)(_.A,{label:e,color:"primary",onDelete:()=>J(o[t],e)},t)))})]}),(0,v.jsx)(Pe,{flightId:Y,onSeatSelect:(e,t)=>J(e,t),selectedSeats:o}),(0,v.jsxs)(I.A,{sx:{mt:3,display:"flex",justifyContent:"space-between"},children:[(0,v.jsx)(d.A,{variant:"outlined",onClick:()=>t(-1),disabled:l,children:"Back"}),(0,v.jsxs)(I.A,{sx:{display:"flex",gap:2},children:[o.length>0&&(0,v.jsx)(d.A,{variant:"outlined",color:"primary",onClick:()=>{f(!0)},disabled:l,children:"Enter Passenger Info"}),(0,v.jsx)(d.A,{variant:"contained",color:"primary",disabled:0===o.length||l,onClick:Z,children:l?(0,v.jsx)(F.A,{size:24}):"Book ".concat(o.length," Seat").concat(1!==o.length?"s":"")})]})]}),l&&(0,v.jsx)(I.A,{sx:{position:"absolute",top:0,left:0,right:0,bottom:0,display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:"rgba(255, 255, 255, 0.7)",zIndex:10},children:(0,v.jsx)(F.A,{})}),(0,v.jsxs)(Se.A,{open:A,onClose:K,maxWidth:"md",fullWidth:!0,children:[(0,v.jsx)(ke.A,{children:(0,v.jsx)(c.A,{variant:"h6",children:"Passenger Information"})}),(0,v.jsxs)(Ce.A,{children:[(0,v.jsx)(c.A,{variant:"subtitle2",sx:{mb:2},children:"Please enter information for each passenger. Fields marked with * are required."}),b.map(((e,t)=>(0,v.jsxs)(I.A,{sx:{mb:3},children:[(0,v.jsxs)(c.A,{variant:"subtitle1",sx:{fontWeight:"bold",mb:1},children:["Passenger ",t+1," - Seat ",e.seatNumber]}),(0,v.jsxs)(W.Ay,{container:!0,spacing:2,children:[(0,v.jsx)(W.Ay,{item:!0,xs:12,sm:6,children:(0,v.jsx)(N.A,{fullWidth:!0,required:!0,label:"First Name",value:e.firstName,onChange:t=>X(e.seatId,"firstName",t.target.value),error:!!G(t,"firstName"),helperText:G(t,"firstName")})}),(0,v.jsx)(W.Ay,{item:!0,xs:12,sm:6,children:(0,v.jsx)(N.A,{fullWidth:!0,required:!0,label:"Last Name",value:e.lastName,onChange:t=>X(e.seatId,"lastName",t.target.value),error:!!G(t,"lastName"),helperText:G(t,"lastName")})}),(0,v.jsx)(W.Ay,{item:!0,xs:12,sm:6,children:(0,v.jsx)(N.A,{fullWidth:!0,label:"Email",type:"email",value:e.email,onChange:t=>X(e.seatId,"email",t.target.value),error:!!G(t,"email"),helperText:G(t,"email")})}),(0,v.jsx)(W.Ay,{item:!0,xs:12,sm:6,children:(0,v.jsx)(N.A,{fullWidth:!0,label:"Phone",value:e.phone,onChange:t=>X(e.seatId,"phone",t.target.value),error:!!G(t,"phone"),helperText:G(t,"phone")})}),(0,v.jsx)(W.Ay,{item:!0,xs:12,sm:6,children:(0,v.jsx)(N.A,{fullWidth:!0,label:"Age",type:"number",inputProps:{min:0,max:120},value:e.age,onChange:t=>X(e.seatId,"age",t.target.value),error:!!G(t,"age"),helperText:G(t,"age")})})]}),t<b.length-1&&(0,v.jsx)(u.A,{sx:{mt:2}})]},e.seatId)))]}),(0,v.jsxs)(Ie.A,{children:[(0,v.jsx)(d.A,{onClick:K,children:"Close"}),(0,v.jsx)(d.A,{onClick:()=>{V()&&(f(!1),Z())},color:"primary",variant:"contained",children:"Confirm & Book"})]})]}),(0,v.jsx)(we.A,{open:!!g,autoHideDuration:3e3,onClose:()=>p(null),anchorOrigin:{vertical:"bottom",horizontal:"center"},children:(0,v.jsx)(w.A,{onClose:()=>p(null),severity:"success",children:g})})]})})};var Te=o(11444);const ze=()=>{const e=(0,n.Zp)();return(0,v.jsxs)(k.A,{maxWidth:"lg",sx:{mt:4},children:[(0,v.jsxs)(I.A,{textAlign:"center",mb:4,children:[(0,v.jsx)(c.A,{variant:"h3",gutterBottom:!0,children:"Welcome to Ticket Booking"}),(0,v.jsx)(c.A,{variant:"h6",color:"textSecondary",children:"Book your flights with ease"})]}),(0,v.jsxs)(W.Ay,{container:!0,spacing:3,children:[(0,v.jsx)(W.Ay,{item:!0,xs:12,md:4,children:(0,v.jsxs)(C.A,{sx:{p:3,textAlign:"center",height:"100%",display:"flex",flexDirection:"column",alignItems:"center"},children:[(0,v.jsx)(Te.A,{sx:{fontSize:60,mb:2,color:"primary.main"}}),(0,v.jsx)(c.A,{variant:"h5",gutterBottom:!0,children:"Search Flights"}),(0,v.jsx)(c.A,{variant:"body1",sx:{mb:2},children:"Find the best flights for your journey"}),(0,v.jsx)(d.A,{variant:"contained",onClick:()=>e("/flights"),sx:{mt:"auto"},children:"Search Now"})]})}),(0,v.jsx)(W.Ay,{item:!0,xs:12,md:4,children:(0,v.jsxs)(C.A,{sx:{p:3,textAlign:"center",height:"100%",display:"flex",flexDirection:"column",alignItems:"center"},children:[(0,v.jsx)(f.A,{sx:{fontSize:60,mb:2,color:"primary.main"}}),(0,v.jsx)(c.A,{variant:"h5",gutterBottom:!0,children:"My Profile"}),(0,v.jsx)(c.A,{variant:"body1",sx:{mb:2},children:"Manage your account and preferences"}),(0,v.jsx)(d.A,{variant:"contained",onClick:()=>e("/profile"),sx:{mt:"auto"},children:"View Profile"})]})}),(0,v.jsx)(W.Ay,{item:!0,xs:12,md:4,children:(0,v.jsxs)(C.A,{sx:{p:3,textAlign:"center",height:"100%",display:"flex",flexDirection:"column",alignItems:"center"},children:[(0,v.jsx)(b.A,{sx:{fontSize:60,mb:2,color:"primary.main"}}),(0,v.jsx)(c.A,{variant:"h5",gutterBottom:!0,children:"Booking History"}),(0,v.jsx)(c.A,{variant:"body1",sx:{mb:2},children:"View and manage your bookings"}),(0,v.jsx)(d.A,{variant:"contained",onClick:()=>e("/bookings"),sx:{mt:"auto"},children:"View Bookings"})]})})]})]})};var Oe=o(98761),Ue=o(5278);const Le=()=>{const[e,t]=(0,s.useState)(null),[o,r]=(0,s.useState)(!1),[n,i]=(0,s.useState)(!0),[a,l]=(0,s.useState)(""),[h,x]=(0,s.useState)(""),[g,p]=(0,s.useState)(!0),[A,b]=(0,s.useState)(!1),{user:j,logout:S}=(0,y.As)();(0,s.useEffect)((()=>{(async()=>{l(""),x(""),i(!0);try{const o=localStorage.getItem("token");if(!o)throw new Error("User not authenticated.");try{const e=await re.A.get("http://localhost:8080/api/user/profile",{headers:{Authorization:"Bearer ".concat(o),"Content-Type":"application/json"}});t(e.data),p(!0)}catch(e){console.error("\u274c Error fetching profile:",e),p(!1);const s=(0,Ue.A)(o);t(j?{email:j.email,firstName:j.firstName||"",lastName:j.lastName||""}:{email:s.email})}}catch(a){console.error("\u274c Error in profile component:",a),l("Failed to load profile.")}finally{i(!1)}})()}),[j]);const B=o=>{if(e){const{name:s,value:r}=o.target;"email"===s&&r!==e.email&&b(!0),t((0,E.A)((0,E.A)({},e),{},{[s]:r}))}};return n?(0,v.jsx)(I.A,{display:"flex",justifyContent:"center",alignItems:"center",height:"80vh",children:(0,v.jsx)(F.A,{})}):(0,v.jsx)(k.A,{maxWidth:"md",sx:{mt:4},children:(0,v.jsxs)(C.A,{elevation:3,sx:{p:4},children:[(0,v.jsxs)(I.A,{display:"flex",alignItems:"center",mb:4,children:[(0,v.jsx)(m.A,{sx:{width:80,height:80,mr:2,bgcolor:"primary.main"},children:(0,v.jsx)(f.A,{sx:{fontSize:40}})}),(0,v.jsx)(c.A,{variant:"h4",children:"My Profile"})]}),(0,v.jsx)(u.A,{sx:{mb:4}}),!g&&(0,v.jsx)(w.A,{severity:"warning",sx:{mb:3},children:"Profile API is not available. Displaying information from your login credentials. Changes may not be saved to the backend."}),a&&(0,v.jsx)(w.A,{severity:"error",sx:{mb:3},children:a}),h&&(0,v.jsx)(w.A,{severity:"success",sx:{mb:3},children:h}),(0,v.jsxs)(I.A,{component:"form",onSubmit:async t=>{if(t.preventDefault(),l(""),x(""),i(!0),g)try{const t=localStorage.getItem("token");if(!t)throw new Error("User not authenticated.");await re.A.put("http://localhost:8080/api/user/update",e,{headers:{Authorization:"Bearer ".concat(t),"Content-Type":"application/json"}});A?(x("Email updated successfully! You will be logged out to apply changes."),setTimeout((()=>{localStorage.setItem("userEmail",(null===e||void 0===e?void 0:e.email)||""),S()}),3e3)):(x("Profile updated successfully!"),r(!1))}catch(a){console.error("\u274c Error updating profile:",a),a.response&&a.response.data&&a.response.data.message?l(a.response.data.message):(l("Failed to update profile. The API endpoint may not be available."),p(!1))}finally{i(!1)}else setTimeout((()=>{x("Profile updated successfully! (Note: Changes are not saved to backend)"),r(!1),i(!1)}),500)},children:[(0,v.jsxs)(W.Ay,{container:!0,spacing:3,children:[(0,v.jsx)(W.Ay,{item:!0,xs:12,sm:6,children:(0,v.jsx)(N.A,{fullWidth:!0,label:"First Name",name:"firstName",value:(null===e||void 0===e?void 0:e.firstName)||"",onChange:B,disabled:!o})}),(0,v.jsx)(W.Ay,{item:!0,xs:12,sm:6,children:(0,v.jsx)(N.A,{fullWidth:!0,label:"Last Name",name:"lastName",value:(null===e||void 0===e?void 0:e.lastName)||"",onChange:B,disabled:!o})}),(0,v.jsxs)(W.Ay,{item:!0,xs:12,children:[(0,v.jsx)(N.A,{fullWidth:!0,label:"Email",name:"email",type:"email",value:(null===e||void 0===e?void 0:e.email)||"",onChange:B,disabled:!o,required:!0,error:A}),o&&A&&(0,v.jsx)(Oe.A,{sx:{color:"warning.main"},children:"Changing your email will require you to log in again."}),o&&(0,v.jsx)(Oe.A,{children:"This email will be used for ticket notifications and account recovery."})]}),(0,v.jsx)(W.Ay,{item:!0,xs:12,children:(0,v.jsx)(N.A,{fullWidth:!0,label:"Phone",name:"phone",value:(null===e||void 0===e?void 0:e.phone)||"",onChange:B,disabled:!o})}),(0,v.jsx)(W.Ay,{item:!0,xs:12,children:(0,v.jsx)(N.A,{fullWidth:!0,label:"Address",name:"address",multiline:!0,rows:3,value:(null===e||void 0===e?void 0:e.address)||"",onChange:B,disabled:!o})})]}),(0,v.jsx)(I.A,{sx:{mt:4,display:"flex",gap:2,justifyContent:"flex-end"},children:o?(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)(d.A,{variant:"outlined",onClick:()=>{r(!1),b(!1)},children:"Cancel"}),(0,v.jsx)(d.A,{type:"submit",variant:"contained",children:"Save Changes"})]}):(0,v.jsx)(d.A,{variant:"contained",onClick:()=>r(!0),children:"Edit Profile"})})]})]})})};var _e=o(52307),Ye=o(76247),He=o(67626),qe=o(86174),Je=o(1887),Ve=o(21007),Ke=o(13087),Ze=o(73866);o(44203);const Ge=[{id:12345,flightId:"1",seatIds:[101,102],timestamp:se()().subtract(5,"days").format(),status:"completed",passengers:[{id:1001,firstName:"John",lastName:"Doe",email:"john.doe@example.com",phone:"9876543210",age:35,seatId:101},{id:1002,firstName:"Jane",lastName:"Doe",email:"jane.doe@example.com",phone:"9876543211",age:32,seatId:102}]},{id:12346,flightId:"2",seatIds:[204],timestamp:se()().subtract(1,"days").format(),status:"confirmed",passengers:[{id:1003,firstName:"Alice",lastName:"Smith",email:"alice.smith@example.com",phone:"9876543212",age:28,seatId:204}]},{id:12347,flightId:"3",seatIds:[305,306],timestamp:se()().subtract(10,"days").format(),status:"cancelled",passengers:[{id:1004,firstName:"Bob",lastName:"Johnson",email:"bob.johnson@example.com",phone:"9876543213",age:42,seatId:305},{id:1005,firstName:"Carol",lastName:"Johnson",email:"carol.johnson@example.com",phone:"9876543214",age:38,seatId:306}]}],Xe=()=>{const[e,t]=(0,s.useState)([]),[o,r]=(0,s.useState)(!0),[i,a]=(0,s.useState)(null),[l,h]=(0,s.useState)(null),[m,x]=(0,s.useState)(!1),[u,p]=(0,s.useState)(null),[A,f]=(0,s.useState)(!1),[b,j]=(0,s.useState)(!0),[y,S]=(0,s.useState)({status:"",bookingId:void 0,flightDate:"",page:0,size:5,sortBy:"bookingTime",direction:"desc"}),[B,D]=(0,s.useState)(1),[R,P]=(0,s.useState)(0),[M,z]=(0,s.useState)(null),[O,U]=(0,s.useState)(0),L=(0,n.Zp)();(0,s.useEffect)((()=>{Y()}),[y.page,y.size,y.sortBy,y.direction]);const Y=async()=>{r(!0),a(null),console.log("[BookingHistory] Fetching bookings with filters:",JSON.stringify(y));try{const s=localStorage.getItem("token");if(!s)return console.error("[BookingHistory] No token found in localStorage"),a("You must be logged in to view bookings"),void L("/login");console.log("[BookingHistory] Token from localStorage:",s.substring(0,15)+"...");const r=y.status&&""!==y.status||void 0!==y.bookingId&&null!==y.bookingId||y.flightDate&&""!==y.flightDate;try{let e;if(r){console.log("[BookingHistory] Using filtered endpoint with filters:",JSON.stringify(y));const o=(0,E.A)((0,E.A)({},y),{},{bookingId:y.bookingId||void 0,status:y.status||void 0,flightDate:y.flightDate||void 0});if(console.log("[BookingHistory] Cleaned filters:",JSON.stringify(o)),e=await(0,T.WO)(s,o),console.log("[BookingHistory] Filtered bookings response:",e),e&&e.bookings)console.log("[BookingHistory] Received ".concat(e.bookings.length," bookings from API")),t(e.bookings),D(e.totalPages||1),P(e.totalItems||e.bookings.length),j(!0);else if(b)console.log("[BookingHistory] No bookings found in API response"),t([]);else{console.log("[BookingHistory] API response missing bookings array, falling back to demo data");let e=[...Ge];y.status&&(e=e.filter((e=>{var t;return e.status.toLowerCase()===(null===(t=y.status)||void 0===t?void 0:t.toLowerCase())}))),y.bookingId&&(e=e.filter((e=>e.id===y.bookingId))),t(e)}}else console.log("[BookingHistory] Fetching all bookings without filters"),e=await(0,T.W2)(s),console.log("[BookingHistory] All bookings response:",e),Array.isArray(e)&&e.length>0?(console.log("[BookingHistory] Received ".concat(e.length," bookings from API")),t(e),j(!0)):e&&"object"===typeof e&&e.bookings?(console.log("[BookingHistory] Received ".concat(e.bookings.length," bookings (object format)")),t(e.bookings),j(!0)):b?(console.log("[BookingHistory] No bookings found in API response"),t([])):(console.log("[BookingHistory] API response format incorrect, using demo data"),t(Ge))}catch(e){if(console.error("[BookingHistory] API Error in fetchBookings:",e),console.error("[BookingHistory] Error details:",e.message),r)try{console.log("[BookingHistory] Falling back to simple filter with status:",y.status);const e=await(0,T.kI)(s,y.status,y.bookingId);e&&e.bookings?(console.log("[BookingHistory] Received ".concat(e.bookings.length," bookings from simple filter")),t(e.bookings),P(e.totalItems||e.bookings.length),D(1),j(!0)):(console.log("[BookingHistory] Simple filter returned no bookings, using demo data"),j(!1),t(Ge))}catch(o){console.error("[BookingHistory] Fallback filter also failed:",o),console.error("[BookingHistory] Fallback error details:",o.message),j(!1),t(Ge)}else console.log("[BookingHistory] No fallback attempted, using demo data"),j(!1),t(Ge)}}catch(s){console.error("[BookingHistory] Error in fetchBookings:",s),console.error("[BookingHistory] Error stack:",s.stack),a("Failed to load bookings. Please try again later."),j(!1),t(Ge)}finally{r(!1)}},V=(e,t)=>{S((o=>(0,E.A)((0,E.A)({},o),{},{[e]:t},"page"!==e&&{page:0})))},K=e=>{if(z(e),e){const t=e.format("YYYY-MM-DD");console.log("Setting flightDate to: ".concat(t)),V("flightDate",t)}else V("flightDate","")},Z=()=>{S((e=>(0,E.A)((0,E.A)({},e),{},{page:0}))),Y()},G=()=>{S({status:"",bookingId:void 0,flightDate:"",page:0,size:5,sortBy:"bookingTime",direction:"desc"}),z(null),setTimeout((()=>{Y()}),0)},X=()=>{console.log("Closing cancel dialog, selectedBookingId was:",u),p(null),x(!1)};return(0,v.jsx)(k.A,{maxWidth:"lg",sx:{mt:4,mb:4},children:(0,v.jsxs)(C.A,{elevation:3,sx:{p:3,borderRadius:"8px",boxShadow:"0px 4px 8px rgba(0, 0, 0, 0.1)"},children:[(0,v.jsxs)(I.A,{sx:{p:2,mb:3,background:"linear-gradient(45deg, #E33069 30%, #9C27B0 90%)",color:"white",borderRadius:"8px"},children:[(0,v.jsx)(c.A,{variant:"h5",component:"h1",gutterBottom:!0,children:"Your Booking History"}),(0,v.jsx)(c.A,{variant:"body2",children:"View and manage all your flight bookings in one place"})]}),i&&(0,v.jsx)(w.A,{severity:"error",sx:{mb:3,borderRadius:"8px"},children:i}),o?(0,v.jsx)(I.A,{sx:{display:"flex",justifyContent:"center",my:4},children:(0,v.jsx)(F.A,{})}):0===e.length?(0,v.jsxs)(C.A,{sx:{p:4,textAlign:"center"},children:[(0,v.jsx)(c.A,{variant:"h6",color:"textSecondary",children:"No bookings found"}),(0,v.jsx)(c.A,{color:"textSecondary",sx:{mt:1},children:"You haven't made any bookings yet or none match your current filters."})]}):(0,v.jsxs)(v.Fragment,{children:[(0,v.jsxs)(I.A,{sx:{mb:4,p:2,backgroundColor:"#F5F8FA",borderRadius:"8px"},children:[(0,v.jsx)(c.A,{variant:"h6",gutterBottom:!0,children:"Filter Bookings"}),(0,v.jsxs)(W.Ay,{container:!0,spacing:2,children:[(0,v.jsx)(W.Ay,{item:!0,xs:12,sm:4,md:3,children:(0,v.jsxs)(N.A,{select:!0,label:"Booking Status",value:y.status,onChange:e=>V("status",e.target.value),fullWidth:!0,margin:"normal",size:"small",sx:{"& .MuiOutlinedInput-root":{borderRadius:"8px",bgcolor:"#FFFFFF"}},children:[(0,v.jsx)(g.A,{value:"",children:"All"}),(0,v.jsx)(g.A,{value:"confirmed",children:"Confirmed"}),(0,v.jsx)(g.A,{value:"completed",children:"Completed"}),(0,v.jsx)(g.A,{value:"cancelled",children:"Cancelled"})]})}),(0,v.jsx)(W.Ay,{item:!0,xs:12,sm:4,md:3,children:(0,v.jsx)(N.A,{label:"Booking ID",value:y.bookingId||"",onChange:e=>V("bookingId",e.target.value?parseInt(e.target.value):void 0),fullWidth:!0,margin:"normal",size:"small",type:"number",sx:{"& .MuiOutlinedInput-root":{borderRadius:"8px",bgcolor:"#FFFFFF"}}})}),(0,v.jsx)(W.Ay,{item:!0,xs:12,sm:4,md:3,children:(0,v.jsx)(ee.$,{dateAdapter:te.Y,children:(0,v.jsx)(Q.l,{label:"Flight Date",value:M,onChange:K,slotProps:{textField:{fullWidth:!0,margin:"normal",size:"small",sx:{"& .MuiOutlinedInput-root":{borderRadius:"8px",bgcolor:"#FFFFFF"}}}}})})}),(0,v.jsx)(W.Ay,{item:!0,xs:12,sm:12,md:3,children:(0,v.jsxs)(I.A,{sx:{display:"flex",gap:1,mt:2},children:[(0,v.jsx)(d.A,{variant:"contained",onClick:Z,sx:{bgcolor:"#FF7F23","&:hover":{bgcolor:"#E67D2E"},borderRadius:"8px",flexGrow:1},children:"Apply Filters"}),(0,v.jsx)(d.A,{variant:"outlined",onClick:G,sx:{borderRadius:"8px",borderColor:"#9C27B0",color:"#9C27B0","&:hover":{borderColor:"#7B1FA2",backgroundColor:"rgba(156, 39, 176, 0.04)"}},children:"Reset"})]})})]})]}),(0,v.jsx)(W.Ay,{container:!0,spacing:3,children:e.map((e=>(0,v.jsx)(W.Ay,{item:!0,xs:12,children:(0,v.jsxs)(H.A,{sx:{mb:3,borderRadius:"8px",boxShadow:"0px 4px 8px rgba(0, 0, 0, 0.1)"},children:[(0,v.jsxs)(q.A,{sx:{p:"1.25rem"},children:[(0,v.jsxs)(I.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",mb:2},children:[(0,v.jsxs)(c.A,{variant:"h6",children:["Booking #",e.id]}),(0,v.jsx)(_.A,{label:e.status.charAt(0).toUpperCase()+e.status.slice(1),color:"confirmed"===e.status?"primary":"completed"===e.status?"success":"error",size:"small"})]}),(0,v.jsxs)(W.Ay,{container:!0,spacing:2,children:[(0,v.jsxs)(W.Ay,{item:!0,xs:12,md:6,children:[(0,v.jsxs)(I.A,{sx:{display:"flex",alignItems:"center",mb:1},children:[(0,v.jsx)(Te.A,{color:"primary",sx:{mr:1}}),(0,v.jsx)(c.A,{children:e.flightNumber?"Flight ".concat(e.flightNumber):"Flight ID: ".concat(e.flightId)})]}),e.origin&&e.destination&&(0,v.jsxs)(I.A,{sx:{display:"flex",alignItems:"center",mb:1},children:[(0,v.jsx)(Ve.A,{color:"primary",sx:{mr:1}}),(0,v.jsx)(c.A,{children:"".concat(e.origin," \u2192 ").concat(e.destination)})]}),e.departureTime&&(0,v.jsxs)(I.A,{sx:{display:"flex",alignItems:"center",mb:1},children:[(0,v.jsx)(Ze.A,{color:"primary",sx:{mr:1}}),(0,v.jsx)(c.A,{children:new Date(e.departureTime).toLocaleString()})]}),e.airline&&(0,v.jsxs)(I.A,{sx:{display:"flex",alignItems:"center",mb:1},children:[(0,v.jsx)(Te.A,{color:"primary",sx:{mr:1}}),(0,v.jsx)(c.A,{children:e.airline})]}),(0,v.jsxs)(I.A,{sx:{display:"flex",alignItems:"center",mb:1},children:[(0,v.jsx)(Ke.A,{color:"primary",sx:{mr:1}}),(0,v.jsxs)(c.A,{children:["Booked on: ",se()(e.timestamp).format("MMMM D, YYYY [at] h:mm A")]})]})]}),(0,v.jsxs)(W.Ay,{item:!0,xs:12,md:6,children:[(0,v.jsx)(c.A,{variant:"subtitle2",gutterBottom:!0,children:"Passengers:"}),e.passengers?(0,v.jsx)("ul",{style:{margin:0,paddingLeft:"1.5rem"},children:e.passengers.map(((e,t)=>(0,v.jsxs)("li",{children:[e.firstName," ",e.lastName,e.seatId&&" - Seat ".concat(e.seatId)]},t)))}):(0,v.jsxs)(c.A,{variant:"body2",color:"textSecondary",children:[e.seatIds.length," seat(s) booked"]})]})]})]}),(0,v.jsxs)(J.A,{sx:{justifyContent:"flex-end",p:"1.25rem",pt:0},children:[(0,v.jsx)(d.A,{size:"small",onClick:()=>L("/booking-confirmation/".concat(e.id)),sx:{borderRadius:"8px",borderColor:"#9C27B0",color:"#9C27B0","&:hover":{borderColor:"#7B1FA2",backgroundColor:"rgba(156, 39, 176, 0.04)"}},children:"View Details"}),"confirmed"===e.status&&(0,v.jsx)(d.A,{size:"small",color:"error",onClick:()=>{return t=e.id,console.log("Opening cancel dialog for booking ID: ".concat(t,", type: ").concat(typeof t)),p(t),void x(!0);var t},sx:{borderRadius:"8px"},children:"Cancel Booking"})]})]})},e.id)))}),B>1&&(0,v.jsx)(I.A,{sx:{display:"flex",justifyContent:"center",mt:4},children:(0,v.jsx)(qe.A,{count:B,page:y.page?y.page+1:1,onChange:(e,t)=>{V("page",t-1)},color:"primary"})})]}),(0,v.jsxs)(Se.A,{open:m,onClose:X,PaperProps:{sx:{borderRadius:"8px",boxShadow:"0px 4px 8px rgba(0, 0, 0, 0.1)"}},children:[(0,v.jsx)(ke.A,{children:"Confirm Cancellation"}),(0,v.jsx)(Ce.A,{children:(0,v.jsx)(Je.A,{children:"Are you sure you want to cancel this booking? This action cannot be undone."})}),(0,v.jsxs)(Ie.A,{children:[(0,v.jsx)(d.A,{onClick:X,sx:{color:"#9C27B0"},children:"No, Keep Booking"}),(0,v.jsx)(d.A,{onClick:async()=>{if(u){console.log("Attempting to cancel booking ID: ".concat(u,", type: ").concat(typeof u)),r(!0),a(null);try{if(!b)return console.log("API unavailable, simulating cancellation"),void setTimeout((()=>{const o=e.map((e=>e.id===u?(0,E.A)((0,E.A)({},e),{},{status:"cancelled"}):e));t(o),h("Booking cancelled successfully! (Demo mode)"),X(),r(!1)}),800);const s=localStorage.getItem("token");if(!s)return a("You must be logged in to cancel bookings"),void L("/login");const n=u;console.log("Sending cancellation request with ID: ".concat(n,", type: ").concat(typeof n));try{const o=await(0,T.WD)(n.toString(),s);console.log("Cancellation API response:",o);const i=e.map((e=>e.id===u?(0,E.A)((0,E.A)({},e),{},{status:"cancelled"}):e));t(i),h("Booking cancelled successfully!"),X(),r(!1),setTimeout((()=>{Y()}),1e3)}catch(o){console.error("API error details:",{message:o.message,stack:o.stack,status:o.status,response:o.response});let e="Failed to cancel booking. Please try again later.";o.message&&(e=o.message.includes("not found")?"Booking not found. It may have been already cancelled or deleted.":o.message.includes("already cancelled")?"This booking is already cancelled.":o.message.includes("permission")?"You do not have permission to cancel this booking.":"Error: ".concat(o.message)),a(e),r(!1)}}catch(s){console.error("Error cancelling booking:",s),a("Failed to cancel booking. Please try again later."),r(!1)}}else console.error("Cannot cancel booking: No booking ID selected")},variant:"contained",color:"error",sx:{borderRadius:"8px"},children:"Yes, Cancel Booking"})]})]}),(0,v.jsx)(we.A,{open:!!l,autoHideDuration:6e3,onClose:()=>h(null),message:l})]})})};var $e=o(17109),Qe=o(20117),et=o(59206),tt=o(85555),ot=o(79834),st=o(11554),rt=o(59789),nt=o(35980),it=o(4698),at=o(43786),lt=o(72109),ct=o(55715),dt=o(72467),ht=o(35688),mt=o(13132);const xt=()=>{var e;const{bookingId:t}=(0,n.g)(),o=(0,n.Zp)(),[r,i]=(0,s.useState)(null),[a,l]=(0,s.useState)(!1),[h,m]=(0,s.useState)(!0),[x,g]=(0,s.useState)(null),[p,A]=(0,s.useState)(null),b=e=>{if(!e)return"N/A";return new Date(e).toLocaleDateString("en-US",{weekday:"short",year:"numeric",month:"short",day:"numeric"})},j=e=>{if(!e)return"N/A";return new Date(e).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!0})};(0,s.useEffect)((()=>{(async()=>{m(!0);try{const e=localStorage.getItem("token");if(!e)return g("You must be logged in to view booking details"),void o("/login");const s=await(0,T.m7)(t||"",e);s?(console.log("Booking details fetched:",s),i(s)):g("Booking not found")}catch(e){console.error("Failed to load booking details:",e),g("Could not load booking details. Please try again.")}finally{m(!1)}})()}),[t,o]);if(h)return(0,v.jsx)(k.A,{maxWidth:"sm",sx:{mt:4,textAlign:"center"},children:(0,v.jsx)(F.A,{})});if(x||!r)return(0,v.jsx)(k.A,{maxWidth:"sm",sx:{mt:4},children:(0,v.jsxs)(C.A,{sx:{p:4,textAlign:"center"},children:[(0,v.jsx)(c.A,{variant:"h5",color:"error",gutterBottom:!0,children:x||"Booking Not Found"}),(0,v.jsx)(d.A,{variant:"contained",onClick:()=>o("/flights"),sx:{mt:2},children:"Return to Flights"})]})});const y=r.passengers&&r.passengers.length>0,S=r.flightId&&r.origin&&r.destination;return(0,v.jsx)(k.A,{maxWidth:"md",sx:{mt:4},children:(0,v.jsxs)(C.A,{sx:{p:4,borderRadius:"8px",boxShadow:"0px 4px 8px rgba(0, 0, 0, 0.1)"},children:[(0,v.jsx)($e.A,{activeStep:2,alternativeLabel:!0,sx:{mb:4},children:["Flight Selected","Seats Booked","Booking Confirmed"].map((e=>(0,v.jsx)(Qe.A,{children:(0,v.jsx)(et.A,{children:e})},e)))}),(0,v.jsx)(we.A,{open:!!p,autoHideDuration:6e3,onClose:()=>A(null),message:p,anchorOrigin:{vertical:"top",horizontal:"center"},sx:{"& .MuiSnackbarContent-root":{backgroundColor:"#4caf50",color:"white"}}}),(0,v.jsxs)(I.A,{sx:{textAlign:"center",mb:4,p:3,background:"linear-gradient(45deg, #E33069 30%, #9C27B0 90%)",borderRadius:"8px",color:"white"},children:[(0,v.jsx)(st.A,{sx:{fontSize:60,mb:2,color:"white"}}),(0,v.jsx)(c.A,{variant:"h4",gutterBottom:!0,children:"Booking Confirmed!"}),(0,v.jsx)(c.A,{children:"Your booking has been successfully completed"})]}),(0,v.jsx)(u.A,{sx:{my:3}}),(0,v.jsxs)(W.Ay,{container:!0,spacing:3,children:[(0,v.jsx)(W.Ay,{item:!0,xs:12,md:6,children:(0,v.jsx)(H.A,{sx:{borderRadius:"8px",boxShadow:"0px 4px 8px rgba(0, 0, 0, 0.1)"},children:(0,v.jsxs)(q.A,{sx:{p:"1.25rem"},children:[(0,v.jsxs)(c.A,{variant:"h6",gutterBottom:!0,children:[(0,v.jsx)(Te.A,{sx:{mr:1,verticalAlign:"middle",color:"#9C27B0"}}),"Flight Information"]}),S?(0,v.jsxs)(I.A,{sx:{display:"flex",flexDirection:"column",gap:2},children:[(0,v.jsxs)(W.Ay,{container:!0,spacing:2,children:[(0,v.jsxs)(W.Ay,{item:!0,xs:12,md:6,children:[(0,v.jsxs)(I.A,{sx:{display:"flex",alignItems:"center",mb:1},children:[(0,v.jsx)(ct.A,{sx:{mr:1,color:"primary.main"}}),(0,v.jsx)(c.A,{variant:"h6",children:"Departure"})]}),(0,v.jsxs)(c.A,{variant:"body1",children:[(0,v.jsx)("b",{children:"From:"})," ",(null===r||void 0===r?void 0:r.origin)||"N/A"]}),(0,v.jsxs)(I.A,{sx:{display:"flex",alignItems:"center",mt:1},children:[(0,v.jsx)(lt.A,{fontSize:"small",sx:{mr:1,color:"text.secondary"}}),(0,v.jsx)(c.A,{variant:"body2",children:b(null===r||void 0===r?void 0:r.departureTime)})]}),(0,v.jsxs)(I.A,{sx:{display:"flex",alignItems:"center",mt:1},children:[(0,v.jsx)(Ke.A,{fontSize:"small",sx:{mr:1,color:"text.secondary"}}),(0,v.jsx)(c.A,{variant:"body2",children:j(null===r||void 0===r?void 0:r.departureTime)})]})]}),(0,v.jsxs)(W.Ay,{item:!0,xs:12,md:6,children:[(0,v.jsxs)(I.A,{sx:{display:"flex",alignItems:"center",mb:1},children:[(0,v.jsx)(ne.A,{sx:{mr:1,color:"primary.main"}}),(0,v.jsx)(c.A,{variant:"h6",children:"Arrival"})]}),(0,v.jsxs)(c.A,{variant:"body1",children:[(0,v.jsx)("b",{children:"To:"})," ",(null===r||void 0===r?void 0:r.destination)||"N/A"]}),(0,v.jsxs)(I.A,{sx:{display:"flex",alignItems:"center",mt:1},children:[(0,v.jsx)(lt.A,{fontSize:"small",sx:{mr:1,color:"text.secondary"}}),(0,v.jsx)(c.A,{variant:"body2",children:b(null===r||void 0===r?void 0:r.arrivalTime)})]}),(0,v.jsxs)(I.A,{sx:{display:"flex",alignItems:"center",mt:1},children:[(0,v.jsx)(Ke.A,{fontSize:"small",sx:{mr:1,color:"text.secondary"}}),(0,v.jsx)(c.A,{variant:"body2",children:j(null===r||void 0===r?void 0:r.arrivalTime)})]})]})]}),(0,v.jsxs)(I.A,{sx:{mt:2},children:[(0,v.jsx)(u.A,{sx:{mb:2}}),(0,v.jsxs)(W.Ay,{container:!0,spacing:2,children:[(0,v.jsx)(W.Ay,{item:!0,xs:12,sm:6,children:(0,v.jsxs)(I.A,{sx:{display:"flex",alignItems:"center"},children:[(0,v.jsx)(ct.A,{fontSize:"small",sx:{mr:1,color:"text.secondary"}}),(0,v.jsxs)(c.A,{variant:"body2",children:[(0,v.jsx)("b",{children:"Flight:"})," ",null===r||void 0===r?void 0:r.airline," ",null===r||void 0===r?void 0:r.flightNumber]})]})}),(0,v.jsx)(W.Ay,{item:!0,xs:12,sm:6,children:(0,v.jsxs)(I.A,{sx:{display:"flex",alignItems:"center"},children:[(0,v.jsx)(dt.A,{fontSize:"small",sx:{mr:1,color:"text.secondary"}}),(0,v.jsxs)(c.A,{variant:"body2",children:[(0,v.jsx)("b",{children:"Class:"})," ",(null===r||void 0===r?void 0:r.seatClass)||"Economy"]})]})}),(0,v.jsx)(W.Ay,{item:!0,xs:12,sm:6,children:(0,v.jsxs)(I.A,{sx:{display:"flex",alignItems:"center"},children:[(0,v.jsx)(Ke.A,{fontSize:"small",sx:{mr:1,color:"text.secondary"}}),(0,v.jsxs)(c.A,{variant:"body2",children:[(0,v.jsx)("b",{children:"Duration:"})," ",((e,t)=>{if(!e||!t)return"N/A";const o=new Date(e),s=new Date(t).getTime()-o.getTime(),r=Math.floor(s/36e5),n=Math.floor(s%36e5/6e4);return"".concat(r,"h ").concat(n,"m")})(null===r||void 0===r?void 0:r.departureTime,null===r||void 0===r?void 0:r.arrivalTime)]})]})}),(0,v.jsx)(W.Ay,{item:!0,xs:12,sm:6,children:(0,v.jsxs)(I.A,{sx:{display:"flex",alignItems:"center"},children:[(0,v.jsx)(ht.A,{fontSize:"small",sx:{mr:1,color:"text.secondary"}}),(0,v.jsxs)(c.A,{variant:"body2",children:[(0,v.jsx)("b",{children:"Booking ID:"})," ",null===r||void 0===r?void 0:r.id]})]})}),(0,v.jsx)(W.Ay,{item:!0,xs:12,children:(0,v.jsxs)(I.A,{sx:{display:"flex",alignItems:"center",mt:1},children:[(0,v.jsx)(mt.A,{fontSize:"small",sx:{mr:1,color:"text.secondary"}}),(0,v.jsx)(c.A,{variant:"body2",sx:{mr:1},children:(0,v.jsx)("b",{children:"Booking Status:"})}),(e=>{if(!e)return null;switch(e.toLowerCase()){case"confirmed":return(0,v.jsx)(_.A,{label:"Confirmed",color:"success",size:"small",sx:{fontWeight:"bold"}});case"completed":return(0,v.jsx)(_.A,{label:"Completed",color:"info",size:"small",sx:{fontWeight:"bold"}});case"cancelled":return(0,v.jsx)(_.A,{label:"Cancelled",color:"error",size:"small",sx:{fontWeight:"bold"}});default:return(0,v.jsx)(_.A,{label:e,color:"default",size:"small"})}})(null===r||void 0===r?void 0:r.status)]})}),(null===r||void 0===r?void 0:r.flightStatus)&&(0,v.jsx)(W.Ay,{item:!0,xs:12,children:(0,v.jsxs)(I.A,{sx:{display:"flex",alignItems:"center",mt:1},children:[(0,v.jsx)(ne.A,{fontSize:"small",sx:{mr:1,color:"text.secondary"}}),(0,v.jsx)(c.A,{variant:"body2",sx:{mr:1},children:(0,v.jsx)("b",{children:"Flight Status:"})}),(e=>{if(!e)return null;switch(e.toUpperCase()){case"SCHEDULED":return(0,v.jsx)(_.A,{label:"Scheduled",color:"primary",size:"small",sx:{fontWeight:"bold"}});case"IN_FLIGHT":return(0,v.jsx)(_.A,{label:"In Flight",color:"info",size:"small",sx:{fontWeight:"bold"}});case"ARRIVED":return(0,v.jsx)(_.A,{label:"Arrived",color:"success",size:"small",sx:{fontWeight:"bold"}});case"DELAYED":return(0,v.jsx)(_.A,{label:"Delayed",color:"warning",size:"small",sx:{fontWeight:"bold"}});case"CANCELLED":return(0,v.jsx)(_.A,{label:"Cancelled",color:"error",size:"small",sx:{fontWeight:"bold"}});default:return(0,v.jsx)(_.A,{label:e,color:"default",size:"small"})}})(null===r||void 0===r?void 0:r.flightStatus)]})})]})]})]}):(0,v.jsx)(w.A,{severity:"info",sx:{mt:2,borderRadius:"8px"},children:"Flight details not available"})]})})}),(0,v.jsx)(W.Ay,{item:!0,xs:12,md:6,children:(0,v.jsx)(H.A,{sx:{borderRadius:"8px",boxShadow:"0px 4px 8px rgba(0, 0, 0, 0.1)"},children:(0,v.jsxs)(q.A,{sx:{p:"1.25rem"},children:[(0,v.jsxs)(c.A,{variant:"h6",gutterBottom:!0,children:[(0,v.jsx)(ce.A,{sx:{mr:1,verticalAlign:"middle",color:"#9C27B0"}}),"Seat Information"]}),(0,v.jsxs)(I.A,{sx:{mt:2},children:[(0,v.jsx)(c.A,{variant:"subtitle2",color:"text.secondary",children:"Number of Seats"}),(0,v.jsx)(c.A,{variant:"body1",gutterBottom:!0,children:r.seatIds.length}),(0,v.jsx)(c.A,{variant:"subtitle2",color:"text.secondary",sx:{mt:1},children:"Seat IDs"}),(0,v.jsx)(c.A,{variant:"body1",gutterBottom:!0,children:r.seatIds.join(", ")}),r.price&&(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)(c.A,{variant:"subtitle2",color:"text.secondary",sx:{mt:1},children:"Fare Details"}),(0,v.jsxs)(c.A,{variant:"body2",gutterBottom:!0,children:["Base fare (per seat): \u20b9",r.price.toLocaleString()]}),(0,v.jsxs)(c.A,{variant:"body2",gutterBottom:!0,children:["Number of seats: ",r.seatIds.length]}),(0,v.jsxs)(c.A,{variant:"body1",fontWeight:"bold",sx:{mt:1},children:["Total amount: \u20b9",(r.price*r.seatIds.length).toLocaleString()]})]})]})]})})}),(0,v.jsx)(W.Ay,{item:!0,xs:12,md:6,children:(0,v.jsx)(H.A,{sx:{borderRadius:"8px",boxShadow:"0px 4px 8px rgba(0, 0, 0, 0.1)"},children:(0,v.jsxs)(q.A,{sx:{p:"1.25rem"},children:[(0,v.jsxs)(c.A,{variant:"h6",gutterBottom:!0,children:[(0,v.jsx)(f.A,{sx:{mr:1,verticalAlign:"middle",color:"#9C27B0"}}),"Passenger Information"]}),y?(0,v.jsx)(tt.A,{children:null===(e=r.passengers)||void 0===e?void 0:e.map(((e,t)=>{var o;return(0,v.jsxs)(ot.Ay,{divider:t<((null===(o=r.passengers)||void 0===o?void 0:o.length)||0)-1,sx:{flexDirection:"column",alignItems:"flex-start",py:2},children:[(0,v.jsxs)(I.A,{sx:{display:"flex",width:"100%",mb:1,alignItems:"center"},children:[(0,v.jsxs)(c.A,{variant:"subtitle1",sx:{fontWeight:"bold",mr:1},children:[e.firstName," ",e.lastName]}),0===t&&(0,v.jsx)(_.A,{label:"Primary",size:"small",color:"primary",sx:{ml:1}})]}),(0,v.jsxs)(W.Ay,{container:!0,spacing:1,sx:{mt:.5},children:[e.email&&(0,v.jsx)(W.Ay,{item:!0,xs:12,sm:6,children:(0,v.jsxs)(I.A,{sx:{display:"flex",alignItems:"center"},children:[(0,v.jsx)(it.A,{fontSize:"small",sx:{mr:.5,color:"text.secondary"}}),(0,v.jsx)(c.A,{variant:"body2",children:e.email})]})}),e.phone&&(0,v.jsx)(W.Ay,{item:!0,xs:12,sm:6,children:(0,v.jsxs)(I.A,{sx:{display:"flex",alignItems:"center"},children:[(0,v.jsx)(at.A,{fontSize:"small",sx:{mr:.5,color:"text.secondary"}}),(0,v.jsx)(c.A,{variant:"body2",children:e.phone})]})}),e.age&&(0,v.jsx)(W.Ay,{item:!0,xs:12,sm:6,children:(0,v.jsxs)(I.A,{sx:{display:"flex",alignItems:"center"},children:[(0,v.jsx)(f.A,{fontSize:"small",sx:{mr:.5,color:"text.secondary"}}),(0,v.jsxs)(c.A,{variant:"body2",children:["Age: ",e.age]})]})}),e.seatId&&(0,v.jsx)(W.Ay,{item:!0,xs:12,sm:6,children:(0,v.jsxs)(I.A,{sx:{display:"flex",alignItems:"center"},children:[(0,v.jsx)(ce.A,{fontSize:"small",sx:{mr:.5,color:"text.secondary"}}),(0,v.jsxs)(c.A,{variant:"body2",children:["Seat: ",e.seatId]})]})})]})]},t)}))}):(0,v.jsx)(w.A,{severity:"info",sx:{mt:2,borderRadius:"8px"},children:"Passenger details not available"})]})})})]}),(0,v.jsxs)(I.A,{sx:{mt:4,display:"flex",gap:2,justifyContent:"center"},children:[(0,v.jsx)(d.A,{variant:"outlined",startIcon:(0,v.jsx)(nt.A,{}),onClick:async()=>{try{m(!0);const e=localStorage.getItem("token");if(!e)return void g("You must be logged in to download a ticket");await(0,T.VE)(t||"",e),A("Ticket downloaded successfully")}catch(e){console.error("Download error:",e),g("Failed to download ticket. Please try again.")}finally{m(!1)}},sx:{borderRadius:"8px",borderColor:"#9C27B0",color:"#9C27B0","&:hover":{borderColor:"#7B1FA2",backgroundColor:"rgba(156, 39, 176, 0.04)"}},children:"Download Ticket"}),(0,v.jsx)(d.A,{variant:"outlined",startIcon:(0,v.jsx)(it.A,{}),onClick:async()=>{try{m(!0);const e=localStorage.getItem("token");if(!e)return void g("You must be logged in to email a ticket");const o=await(0,T.x9)(t||"",e);A(o.message||"Ticket has been sent to your email")}catch(e){console.error("Email error:",e),e&&e.message?g(e.message):e&&403===e.status?g("You do not have permission to email this ticket."):e&&404===e.status?g("Booking not found."):g("Failed to send email. Please try again.")}finally{m(!1)}},sx:{borderRadius:"8px",borderColor:"#9C27B0",color:"#9C27B0","&:hover":{borderColor:"#7B1FA2",backgroundColor:"rgba(156, 39, 176, 0.04)"}},children:"Email Ticket"}),(0,v.jsx)(d.A,{variant:"outlined",startIcon:(0,v.jsx)(rt.A,{}),onClick:()=>l(!0),sx:{borderRadius:"8px",borderColor:"#9C27B0",color:"#9C27B0","&:hover":{borderColor:"#7B1FA2",backgroundColor:"rgba(156, 39, 176, 0.04)"}},children:"Share"})]}),(0,v.jsxs)(I.A,{sx:{display:"flex",gap:2,justifyContent:"center",mt:2},children:[(0,v.jsx)(d.A,{variant:"outlined",onClick:()=>o("/bookings"),sx:{borderRadius:"8px",borderColor:"#9C27B0",color:"#9C27B0","&:hover":{borderColor:"#7B1FA2",backgroundColor:"rgba(156, 39, 176, 0.04)"}},children:"View All Bookings"}),(0,v.jsx)(d.A,{variant:"contained",onClick:()=>o("/flights"),sx:{bgcolor:"#FF7F23","&:hover":{bgcolor:"#E67D2E"},borderRadius:"8px"},children:"Book Another Flight"})]}),(0,v.jsxs)(Se.A,{open:a,onClose:()=>l(!1),PaperProps:{sx:{borderRadius:"8px",boxShadow:"0px 4px 8px rgba(0, 0, 0, 0.1)"}},children:[(0,v.jsx)(ke.A,{children:"Share Booking Details"}),(0,v.jsxs)(Ce.A,{children:[(0,v.jsx)(c.A,{children:"Share your booking confirmation via:"}),(0,v.jsx)(I.A,{sx:{mt:2,display:"flex",gap:2},children:(0,v.jsx)(d.A,{variant:"outlined",startIcon:(0,v.jsx)(it.A,{}),sx:{borderRadius:"8px",borderColor:"#9C27B0",color:"#9C27B0","&:hover":{borderColor:"#7B1FA2",backgroundColor:"rgba(156, 39, 176, 0.04)"}},children:"Email"})})]}),(0,v.jsx)(Ie.A,{children:(0,v.jsx)(d.A,{onClick:()=>l(!1),sx:{color:"#9C27B0"},children:"Close"})})]})]})})},gt=e=>{let{children:t}=e;const o=(0,n.zy)(),{isAuthenticated:r,loading:i,checkAuth:a}=(0,y.As)(),[l,c]=(0,s.useState)(!0);return(0,s.useEffect)((()=>{const e=setTimeout((()=>{const e=a();console.log("ProtectedRoute - Auth state:",{isAuthenticated:r,isValid:e,path:o.pathname,token:localStorage.getItem("token")?"exists":"none"}),c(!1)}),300);return()=>clearTimeout(e)}),[r,a,o.pathname]),i&&l?(0,v.jsx)(I.A,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"50vh"},children:(0,v.jsx)(F.A,{})}):r?(0,v.jsx)(v.Fragment,{children:t}):(console.log("ProtectedRoute - User not authenticated, redirecting to login"),(0,v.jsx)(n.C5,{to:"/login",state:{from:o.pathname},replace:!0}))};var ut=o(80045),pt=o(48419),At=o(87686),ft=o(74225),bt=o(16792),jt=o(85596),yt=o(66899),vt=o(918),St=o(73817),kt=o(8426),Ct=o(12827),It=o(78118),wt=o(44612),Nt=o(63657),Ft=o(10776);const Et=()=>{const[e,t]=(0,s.useState)(!1),[o,r]=(0,s.useState)(!0),[n,i]=(0,s.useState)(!1),[a,l]=(0,s.useState)(""),[h,m]=(0,s.useState)(null);(0,s.useEffect)((()=>{x()}),[]);const x=async()=>{r(!0);try{const e=await re.A.get("http://localhost:8080/api/flights/api-status",{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))}});t(e.data.enabled),l(""),g()}catch(e){console.error("Error fetching API status:",e),l("Failed to fetch API status. Please try again later."),t(!0),A()}finally{r(!1)}},g=async()=>{i(!0);try{const t=await re.A.get("http://localhost:8080/api/flights/api-usage",{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))}});try{const e="string"===typeof t.data?p(t.data):t.data;m(e)}catch(e){console.error("Error parsing API statistics:",e),A()}}catch(t){console.error("Error fetching API statistics:",t),A()}finally{i(!1)}},p=e=>{const t=e.match(/API calls this month: (\d+)/),o=e.match(/Max: (\d+)/),s=(e.match(/\((\d+)%\)/),t?parseInt(t[1]):0);o&&parseInt(o[1]);return{totalCalls:s,successRate:94.7,failureRate:5.3,avgResponseTime:231,callsByEndpoint:{"/flights/search":Math.floor(.6*s),"/flights/details":Math.floor(.2*s),"/pricing":Math.floor(.15*s),"/availability":Math.floor(.05*s)},callsByDay:Array.from({length:7},((e,t)=>{const o=new Date;o.setDate(o.getDate()-(6-t));const r=Math.floor(s/7)+Math.floor(20*Math.random())-10;return{date:o.toISOString().split("T")[0],calls:Math.max(0,r),successRate:90+10*Math.random()}}))}},A=()=>{const e={totalCalls:12458,successRate:94.7,failureRate:5.3,avgResponseTime:231,callsByEndpoint:{"/flights/search":7834,"/flights/details":2304,"/pricing":1562,"/availability":758},callsByDay:Array.from({length:7},((e,t)=>{const o=new Date;return o.setDate(o.getDate()-(6-t)),{date:o.toISOString().split("T")[0],calls:Math.floor(300*Math.random())+100,successRate:90+10*Math.random()}}))};m(e)};return o?(0,v.jsx)(I.A,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"300px"},children:(0,v.jsx)(F.A,{})}):(0,v.jsxs)(I.A,{sx:{p:3},children:[(0,v.jsx)(c.A,{variant:"h5",component:"h2",gutterBottom:!0,children:"External Flight API Management"}),a&&(0,v.jsx)(w.A,{severity:"error",sx:{mb:2},children:a}),(0,v.jsxs)(C.A,{sx:{p:3,mb:3},children:[(0,v.jsx)(ft.A,{control:(0,v.jsx)(bt.A,{checked:e,onChange:async e=>{const o=e.target.checked;try{await re.A.post("http://localhost:8080/api/flights/toggle-api-mode",null,{params:{enableApi:o},headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))}}),t(o),l("")}catch(s){console.error("Error updating API status:",s),l("Failed to update API status. Please try again."),t(o)}},color:"primary"}),label:(0,v.jsx)(c.A,{variant:"h6",children:e?"API Mode: ENABLED":"API Mode: DISABLED"})}),(0,v.jsx)(c.A,{variant:"body1",sx:{mt:1},children:e?"The system is currently fetching flight data from the external API.":"The system is using the local database for flight information."})]}),(0,v.jsx)(c.A,{variant:"h6",sx:{mb:2,mt:4},children:"API Performance Statistics"}),n?(0,v.jsx)(I.A,{sx:{display:"flex",justifyContent:"center",p:3},children:(0,v.jsx)(F.A,{})}):(0,v.jsxs)(v.Fragment,{children:[(0,v.jsxs)(W.Ay,{container:!0,spacing:3,sx:{mb:4},children:[(0,v.jsx)(W.Ay,{item:!0,xs:12,sm:6,md:3,children:(0,v.jsx)(H.A,{children:(0,v.jsxs)(q.A,{children:[(0,v.jsx)(c.A,{color:"textSecondary",gutterBottom:!0,children:"Total API Calls"}),(0,v.jsx)(c.A,{variant:"h4",children:null===h||void 0===h?void 0:h.totalCalls.toLocaleString()})]})})}),(0,v.jsx)(W.Ay,{item:!0,xs:12,sm:6,md:3,children:(0,v.jsx)(H.A,{children:(0,v.jsxs)(q.A,{children:[(0,v.jsx)(c.A,{color:"textSecondary",gutterBottom:!0,children:"Success Rate"}),(0,v.jsxs)(c.A,{variant:"h4",children:[null===h||void 0===h?void 0:h.successRate.toFixed(1),"%"]})]})})}),(0,v.jsx)(W.Ay,{item:!0,xs:12,sm:6,md:3,children:(0,v.jsx)(H.A,{children:(0,v.jsxs)(q.A,{children:[(0,v.jsx)(c.A,{color:"textSecondary",gutterBottom:!0,children:"Failure Rate"}),(0,v.jsxs)(c.A,{variant:"h4",children:[null===h||void 0===h?void 0:h.failureRate.toFixed(1),"%"]})]})})}),(0,v.jsx)(W.Ay,{item:!0,xs:12,sm:6,md:3,children:(0,v.jsx)(H.A,{children:(0,v.jsxs)(q.A,{children:[(0,v.jsx)(c.A,{color:"textSecondary",gutterBottom:!0,children:"Avg Response Time"}),(0,v.jsxs)(c.A,{variant:"h4",children:[null===h||void 0===h?void 0:h.avgResponseTime,"ms"]})]})})})]}),(0,v.jsxs)(W.Ay,{container:!0,spacing:3,children:[(0,v.jsx)(W.Ay,{item:!0,xs:12,md:6,children:(0,v.jsxs)(C.A,{sx:{p:2},children:[(0,v.jsx)(c.A,{variant:"h6",gutterBottom:!0,children:"API Calls by Endpoint"}),(0,v.jsx)(u.A,{sx:{mb:2}}),(0,v.jsx)(jt.u,{width:"100%",height:300,children:(0,v.jsxs)(yt.E,{data:h?Object.entries(h.callsByEndpoint).map((e=>{let[t,o]=e;return{endpoint:t,calls:o}})):[],margin:{top:20,right:30,left:20,bottom:70},children:[(0,v.jsx)(vt.d,{strokeDasharray:"3 3"}),(0,v.jsx)(St.W,{dataKey:"endpoint",angle:-45,textAnchor:"end",height:70}),(0,v.jsx)(kt.h,{}),(0,v.jsx)(Ct.m,{}),(0,v.jsx)(It.y,{dataKey:"calls",fill:"#8884d8",name:"Number of Calls"})]})})]})}),(0,v.jsx)(W.Ay,{item:!0,xs:12,md:6,children:(0,v.jsxs)(C.A,{sx:{p:2},children:[(0,v.jsx)(c.A,{variant:"h6",gutterBottom:!0,children:"API Calls by Day"}),(0,v.jsx)(u.A,{sx:{mb:2}}),(0,v.jsx)(jt.u,{width:"100%",height:300,children:(0,v.jsxs)(wt.b,{data:null===h||void 0===h?void 0:h.callsByDay,margin:{top:20,right:30,left:20,bottom:20},children:[(0,v.jsx)(vt.d,{strokeDasharray:"3 3"}),(0,v.jsx)(St.W,{dataKey:"date"}),(0,v.jsx)(kt.h,{yAxisId:"left"}),(0,v.jsx)(kt.h,{yAxisId:"right",orientation:"right",domain:[0,100]}),(0,v.jsx)(Ct.m,{}),(0,v.jsx)(Nt.s,{}),(0,v.jsx)(Ft.N,{yAxisId:"left",type:"monotone",dataKey:"calls",stroke:"#8884d8",name:"Number of Calls"}),(0,v.jsx)(Ft.N,{yAxisId:"right",type:"monotone",dataKey:"successRate",stroke:"#82ca9d",name:"Success Rate (%)"})]})})]})})]}),(0,v.jsx)(I.A,{sx:{mt:3,display:"flex",justifyContent:"center"},children:(0,v.jsx)(d.A,{variant:"contained",onClick:g,disabled:n,children:"Refresh Statistics"})})]})]})};var Bt=o(13001),Dt=o(2383),Rt=o(57553);const Pt=()=>{const[e,t]=(0,s.useState)([]),[o,r]=(0,s.useState)(!0),[n,i]=(0,s.useState)(null),[a,h]=(0,s.useState)(!1),[m,x]=(0,s.useState)(!1),[u,p]=(0,s.useState)(null),[A,f]=(0,s.useState)({email:"",firstName:"",lastName:"",password:"",role:"CUSTOMER"}),[b,j]=(0,s.useState)({open:!1,message:"",severity:"success"}),y=async()=>{try{return 200===(await re.A.get("http://localhost:8080/api/flights/test",{timeout:5e3})).status}catch(n){return console.error("Server health check failed:",n),!1}},S=async()=>{r(!0),i(null);try{if(!await y())throw new Error("Server is currently unavailable");const e=localStorage.getItem("token");if(!e)throw new Error("Authentication required");const o=(await re.A.get("http://localhost:8080/api/admin/users",{headers:{Authorization:"Bearer ".concat(e)}})).data.map((e=>({id:e.id.toString(),email:e.email,firstName:e.firstName||"",lastName:e.lastName||"",role:e.role,registrationDate:e.registrationDate||(new Date).toISOString()})));t(o)}catch(e){console.error("Error fetching users:",e),"Server is currently unavailable"===e.message?(t([{id:"mock-1",email:"admin@example.com",firstName:"Admin",lastName:"User",role:"ADMIN",registrationDate:"2023-01-01T10:00:00Z"},{id:"mock-2",email:"john.doe@example.com",firstName:"John",lastName:"Doe",role:"CUSTOMER",registrationDate:"2023-02-15T14:30:00Z"},{id:"mock-3",email:"jane.smith@example.com",firstName:"Jane",lastName:"Smith",role:"CUSTOMER",registrationDate:"2023-03-22T09:15:00Z"}]),i("Server is offline. Showing mock data.")):i("Failed to fetch users: ".concat(e.message||"Unknown error"))}finally{r(!1)}},B=e=>{const{name:t,value:o}=e.target;f((e=>(0,E.A)((0,E.A)({},e),{},{[t]:o})))},D=()=>{f({email:"",firstName:"",lastName:"",password:"",role:"CUSTOMER"})},R=()=>{D(),h(!0)},P=()=>{h(!1)},M=()=>{x(!1),p(null)},T=(e,t)=>{j({open:!0,message:e,severity:t})},z=()=>{j((e=>(0,E.A)((0,E.A)({},e),{},{open:!1})))};return(0,s.useEffect)((()=>{S()}),[]),(0,v.jsxs)(k.A,{maxWidth:"xl",sx:{mt:3},children:[(0,v.jsxs)(I.A,{sx:{mb:4},children:[(0,v.jsxs)(I.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[(0,v.jsx)(c.A,{variant:"h5",component:"h2",children:"User Management"}),(0,v.jsxs)(I.A,{sx:{display:"flex",gap:2},children:[(0,v.jsx)(d.A,{variant:"contained",startIcon:(0,v.jsx)(Rt.A,{}),onClick:S,disabled:o,children:"Refresh"}),(0,v.jsx)(d.A,{variant:"contained",color:"primary",startIcon:(0,v.jsx)(Bt.A,{}),onClick:R,children:"Add User"})]})]}),(0,v.jsxs)(C.A,{sx:{width:"100%",p:2},children:[n&&(0,v.jsx)(w.A,{severity:"error",sx:{mb:2},children:n}),o?(0,v.jsx)(I.A,{sx:{display:"flex",justifyContent:"center",p:3},children:(0,v.jsx)(F.A,{})}):e.length>0?(0,v.jsx)(V.A,{children:(0,v.jsxs)(K.A,{children:[(0,v.jsx)(Z.A,{children:(0,v.jsxs)(G.A,{children:[(0,v.jsx)(X.A,{children:"ID"}),(0,v.jsx)(X.A,{children:"Email"}),(0,v.jsx)(X.A,{children:"Name"}),(0,v.jsx)(X.A,{children:"Role"}),(0,v.jsx)(X.A,{children:"Registered"}),(0,v.jsx)(X.A,{children:"Actions"})]})}),(0,v.jsx)($.A,{children:e.map((e=>(0,v.jsxs)(G.A,{children:[(0,v.jsx)(X.A,{children:e.id}),(0,v.jsx)(X.A,{children:e.email}),(0,v.jsx)(X.A,{children:"".concat(e.firstName," ").concat(e.lastName).trim()}),(0,v.jsx)(X.A,{children:e.role}),(0,v.jsx)(X.A,{children:new Date(e.registrationDate).toLocaleDateString()}),(0,v.jsx)(X.A,{children:(0,v.jsx)(l.A,{size:"small",color:"error",onClick:()=>{return t=e.id,p(t),void x(!0);var t},disabled:"ADMIN"===e.role,"aria-label":"delete user",children:(0,v.jsx)(Dt.A,{})})})]},e.id)))})]})}):(0,v.jsxs)(I.A,{sx:{p:3,textAlign:"center"},children:[(0,v.jsx)(c.A,{variant:"body1",gutterBottom:!0,children:"No users available"}),(0,v.jsx)(d.A,{variant:"outlined",startIcon:(0,v.jsx)(Bt.A,{}),onClick:R,children:"Add User"})]})]})]}),(0,v.jsxs)(Se.A,{open:a,onClose:P,maxWidth:"sm",fullWidth:!0,children:[(0,v.jsx)(ke.A,{children:"Add New User"}),(0,v.jsx)(Ce.A,{children:(0,v.jsxs)(W.Ay,{container:!0,spacing:2,sx:{mt:1},children:[(0,v.jsx)(W.Ay,{item:!0,xs:12,children:(0,v.jsx)(N.A,{label:"Email",name:"email",type:"email",value:A.email,onChange:B,fullWidth:!0,required:!0})}),(0,v.jsx)(W.Ay,{item:!0,xs:12,sm:6,children:(0,v.jsx)(N.A,{label:"First Name",name:"firstName",value:A.firstName,onChange:B,fullWidth:!0,required:!0})}),(0,v.jsx)(W.Ay,{item:!0,xs:12,sm:6,children:(0,v.jsx)(N.A,{label:"Last Name",name:"lastName",value:A.lastName,onChange:B,fullWidth:!0,required:!0})}),(0,v.jsx)(W.Ay,{item:!0,xs:12,children:(0,v.jsx)(N.A,{label:"Password",name:"password",type:"password",value:A.password,onChange:B,fullWidth:!0,required:!0})}),(0,v.jsx)(W.Ay,{item:!0,xs:12,children:(0,v.jsxs)(_e.A,{fullWidth:!0,children:[(0,v.jsx)(Ye.A,{id:"role-label",children:"Role"}),(0,v.jsxs)(He.A,{labelId:"role-label",name:"role",value:A.role,label:"Role",onChange:B,children:[(0,v.jsx)(g.A,{value:"CUSTOMER",children:"Customer"}),(0,v.jsx)(g.A,{value:"ADMIN",children:"Admin"})]})]})})]})}),(0,v.jsxs)(Ie.A,{children:[(0,v.jsx)(d.A,{onClick:P,children:"Cancel"}),(0,v.jsx)(d.A,{onClick:async()=>{try{const e=localStorage.getItem("token");if(!e)throw new Error("Authentication required");if(!await y()){const e={id:"mock-".concat(Date.now()),email:A.email,firstName:A.firstName,lastName:A.lastName,role:A.role,registrationDate:(new Date).toISOString()};return t((t=>[...t,e])),T("User added (mock - server offline)","warning"),h(!1),void D()}const o=await re.A.post("http://localhost:8080/api/admin/users",A,{headers:{Authorization:"Bearer ".concat(e)}}),s={id:o.data.id.toString(),email:o.data.email,firstName:o.data.firstName||"",lastName:o.data.lastName||"",role:o.data.role,registrationDate:o.data.registrationDate||(new Date).toISOString()};t((e=>[...e,s])),T("User added successfully","success"),h(!1),D()}catch(e){console.error("Error adding user:",e),T("Failed to add user: ".concat(e.message||"Unknown error"),"error")}},variant:"contained",color:"primary",children:"Add User"})]})]}),(0,v.jsxs)(Se.A,{open:m,onClose:M,children:[(0,v.jsx)(ke.A,{children:"Delete User"}),(0,v.jsx)(Ce.A,{children:(0,v.jsx)(Je.A,{children:"Are you sure you want to delete this user? This action cannot be undone."})}),(0,v.jsxs)(Ie.A,{children:[(0,v.jsx)(d.A,{onClick:M,children:"Cancel"}),(0,v.jsx)(d.A,{onClick:async()=>{if(u)try{const e=localStorage.getItem("token");if(!e)throw new Error("Authentication required");if(!await y())return t((e=>e.filter((e=>e.id!==u)))),T("User deleted (mock - server offline)","warning"),x(!1),void p(null);await re.A.delete("http://localhost:8080/api/admin/users/".concat(u),{headers:{Authorization:"Bearer ".concat(e)}}),t((e=>e.filter((e=>e.id!==u)))),T("User deleted successfully","success"),x(!1),p(null)}catch(e){console.error("Error deleting user:",e),T("Failed to delete user: ".concat(e.message||"Unknown error"),"error")}},color:"error",variant:"contained",children:"Delete"})]})]}),(0,v.jsx)(we.A,{open:b.open,autoHideDuration:6e3,onClose:z,anchorOrigin:{vertical:"bottom",horizontal:"center"},children:(0,v.jsx)(w.A,{onClose:z,severity:b.severity,variant:"filled",sx:{width:"100%"},children:b.message})})]})};var Mt=o(40263),Wt=o(85442);const Tt=["children","value","index"];function zt(e){const{children:t,value:o,index:s}=e,r=(0,ut.A)(e,Tt);return(0,v.jsx)("div",(0,E.A)((0,E.A)({role:"tabpanel",hidden:o!==s,id:"admin-dashboard-tabpanel-".concat(s),"aria-labelledby":"admin-dashboard-tab-".concat(s)},r),{},{children:o===s&&(0,v.jsx)(I.A,{sx:{p:2},children:t})}))}function Ot(e){return{id:"admin-dashboard-tab-".concat(e),"aria-controls":"admin-dashboard-tabpanel-".concat(e)}}const Ut=()=>{const[e,t]=(0,s.useState)(0);return(0,v.jsx)(k.A,{maxWidth:"xl",sx:{mt:4,mb:4},children:(0,v.jsxs)(C.A,{elevation:3,sx:{p:3,mb:4},children:[(0,v.jsx)(c.A,{variant:"h4",component:"h1",gutterBottom:!0,children:"Admin Dashboard"}),(0,v.jsx)(c.A,{variant:"body1",color:"text.secondary",paragraph:!0,children:"Manage your flight booking system settings and monitor system performance."}),(0,v.jsx)(u.A,{sx:{my:2}}),(0,v.jsx)(I.A,{sx:{borderBottom:1,borderColor:"divider"},children:(0,v.jsxs)(pt.A,{value:e,onChange:(e,o)=>{t(o)},"aria-label":"admin dashboard tabs",variant:"scrollable",scrollButtons:"auto",children:[(0,v.jsx)(At.A,(0,E.A)({icon:(0,v.jsx)(Wt.A,{sx:{mr:1}}),iconPosition:"start",label:"API Management"},Ot(0))),(0,v.jsx)(At.A,(0,E.A)({icon:(0,v.jsx)(Mt.A,{sx:{mr:1}}),iconPosition:"start",label:"User Management"},Ot(1)))]})}),(0,v.jsx)(zt,{value:e,index:0,children:(0,v.jsx)(Et,{})}),(0,v.jsx)(zt,{value:e,index:1,children:(0,v.jsx)(Pt,{})})]})})},Lt=e=>{let{children:t}=e;const{user:o,loading:r,checkAuth:i}=(0,y.As)(),[a,l]=(0,s.useState)(!0),[d,h]=(0,s.useState)(!1);if((0,s.useEffect)((()=>{(async()=>{l(!0);const e=i(),t=e&&"ADMIN"===(null===o||void 0===o?void 0:o.role);console.log("AdminRoute auth check:",{isValid:e,isAdmin:t,userRole:(null===o||void 0===o?void 0:o.role)||"none"}),h(t),l(!1)})()}),[o,i]),r||a)return(0,v.jsxs)(I.A,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"80vh"},children:[(0,v.jsx)(F.A,{}),(0,v.jsx)(c.A,{variant:"body1",sx:{ml:2},children:"Verifying admin access..."})]});return i()?d?(console.log("Admin access granted, rendering admin dashboard"),(0,v.jsx)(v.Fragment,{children:t})):(console.log("User not authorized as admin, redirecting to home"),(0,v.jsx)(n.C5,{to:"/",replace:!0})):(console.log("User not authenticated, redirecting to login"),(0,v.jsx)(n.C5,{to:"/login",replace:!0}))},_t=()=>((0,s.useEffect)((()=>{localStorage.getItem("token")&&(0,z.T7)()}),[]),(0,v.jsxs)(r.Kd,{children:[(0,v.jsx)(S,{}),(0,v.jsxs)(n.BV,{children:[(0,v.jsx)(n.qh,{path:"/",element:(0,v.jsx)(ze,{})}),(0,v.jsx)(n.qh,{path:"/login",element:(0,v.jsx)(M,{})}),(0,v.jsx)(n.qh,{path:"/register",element:(0,v.jsx)(O,{})}),(0,v.jsx)(n.qh,{path:"/flights",element:(0,v.jsx)(gt,{children:(0,v.jsx)(ve,{})})}),(0,v.jsx)(n.qh,{path:"/flights/:flightId/seats",element:(0,v.jsx)(gt,{children:(0,v.jsx)(We,{})})}),(0,v.jsx)(n.qh,{path:"/profile",element:(0,v.jsx)(gt,{children:(0,v.jsx)(Le,{})})}),(0,v.jsx)(n.qh,{path:"/bookings",element:(0,v.jsx)(gt,{children:(0,v.jsx)(Xe,{})})}),(0,v.jsx)(n.qh,{path:"/booking-confirmation/:bookingId",element:(0,v.jsx)(gt,{children:(0,v.jsx)(xt,{})})}),(0,v.jsx)(n.qh,{path:"/admin/*",element:(0,v.jsx)(Lt,{children:(0,v.jsx)(Ut,{})})})]})]}))}}]);
//# sourceMappingURL=907.3a418eba.chunk.js.map